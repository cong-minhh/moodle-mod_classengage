{"version":3,"file":"slides_manager.min.js","sources":["../src/slides_manager.js"],"sourcesContent":["/**\r\n * Slides Manager - Professional JavaScript Module\r\n * Handles all interactive features for the slides management interface\r\n *\r\n * @module mod_classengage/slides_manager\r\n * @copyright 2025 Danielle\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\r\n    \r\n    /**\r\n     * Initialize the slides manager\r\n     * @param {number} contextid Context ID\r\n     */\r\n    const init = (contextid) => {\r\n        \r\n        // Bulk Selection Management\r\n        const initBulkSelection = () => {\r\n            const selectAll = $('#select-all-slides');\r\n            const checkboxes = $('.slide-checkbox');\r\n            const bulkToolbar = $('#bulk-toolbar');\r\n            const bulkDeleteBtn = $('#bulk-delete-btn');\r\n            const selectedCount = $('#selected-count');\r\n            const cancelBtn = $('#cancel-selection-btn');\r\n            \r\n            const updateBulkSelection = () => {\r\n                let checkedCount = 0;\r\n                \r\n                checkboxes.each(function() {\r\n                    if ($(this).is(':checked')) {\r\n                        checkedCount++;\r\n                        $(this).closest('.slide-item').addClass('selected');\r\n                    } else {\r\n                        $(this).closest('.slide-item').removeClass('selected');\r\n                    }\r\n                });\r\n                \r\n                if (checkedCount > 0) {\r\n                    bulkToolbar.fadeIn(300).addClass('slide-in-down');\r\n                    bulkDeleteBtn.prop('disabled', false);\r\n                    \r\n                    Str.get_string('selected', 'mod_classengage').then(function(str) {\r\n                        selectedCount.text(checkedCount + ' ' + str);\r\n                        return;\r\n                    }).catch(Notification.exception);\r\n                } else {\r\n                    bulkToolbar.fadeOut(300);\r\n                    bulkDeleteBtn.prop('disabled', true);\r\n                }\r\n            };\r\n            \r\n            selectAll.on('change', function() {\r\n                checkboxes.prop('checked', $(this).is(':checked'));\r\n                updateBulkSelection();\r\n            });\r\n            \r\n            checkboxes.on('change', function() {\r\n                updateBulkSelection();\r\n                if (!$(this).is(':checked')) {\r\n                    selectAll.prop('checked', false);\r\n                }\r\n            });\r\n            \r\n            cancelBtn.on('click', function() {\r\n                checkboxes.prop('checked', false);\r\n                selectAll.prop('checked', false);\r\n                updateBulkSelection();\r\n            });\r\n        };\r\n        \r\n        // Search Functionality with Debounce\r\n        const initSearch = () => {\r\n            const searchInput = $('#slide-search');\r\n            let searchTimeout;\r\n            \r\n            searchInput.on('input', function() {\r\n                clearTimeout(searchTimeout);\r\n                const searchTerm = $(this).val().toLowerCase();\r\n                \r\n                searchTimeout = setTimeout(() => {\r\n                    let visibleCount = 0;\r\n                    \r\n                    $('.slide-item').each(function() {\r\n                        const title = $(this).data('slide-title').toLowerCase();\r\n                        const filename = $(this).data('slide-filename').toLowerCase();\r\n                        \r\n                        if (title.includes(searchTerm) || filename.includes(searchTerm)) {\r\n                            $(this).fadeIn(300);\r\n                            visibleCount++;\r\n                        } else {\r\n                            $(this).fadeOut(300);\r\n                        }\r\n                    });\r\n                    \r\n                    // Show no results message\r\n                    if (visibleCount === 0 && searchTerm !== '') {\r\n                        if ($('#no-results-message').length === 0) {\r\n                            Str.get_string('noresultsfound', 'mod_classengage').then(function(str) {\r\n                                $('#slides-grid').append(\r\n                                    '<div id=\"no-results-message\" class=\"col-12 text-center py-5\">' +\r\n                                    '<i class=\"fa fa-search fa-3x text-muted mb-3\"></i>' +\r\n                                    '<p class=\"text-muted\">' + str + '</p>' +\r\n                                    '</div>'\r\n                                );\r\n                                return;\r\n                            }).catch(Notification.exception);\r\n                        }\r\n                    } else {\r\n                        $('#no-results-message').remove();\r\n                    }\r\n                }, 300);\r\n            });\r\n        };\r\n        \r\n        // Status Filter\r\n        const initStatusFilter = () => {\r\n            const statusFilter = $('#status-filter');\r\n            \r\n            statusFilter.on('change', function() {\r\n                const status = $(this).val();\r\n                let visibleCount = 0;\r\n                \r\n                $('.slide-item').each(function() {\r\n                    if (status === 'all' || $(this).data('slide-status') === status) {\r\n                        $(this).fadeIn(300);\r\n                        visibleCount++;\r\n                    } else {\r\n                        $(this).fadeOut(300);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        \r\n        // View Toggle (Grid/List)\r\n        const initViewToggle = () => {\r\n            const gridViewBtn = $('#grid-view-btn');\r\n            const listViewBtn = $('#list-view-btn');\r\n            const slidesGrid = $('#slides-grid');\r\n            \r\n            gridViewBtn.on('click', function() {\r\n                slidesGrid.removeClass('list-view');\r\n                $(this).addClass('active');\r\n                listViewBtn.removeClass('active');\r\n                \r\n                // Save preference\r\n                localStorage.setItem('classengage_view_mode', 'grid');\r\n            });\r\n            \r\n            listViewBtn.on('click', function() {\r\n                slidesGrid.addClass('list-view');\r\n                $(this).addClass('active');\r\n                gridViewBtn.removeClass('active');\r\n                \r\n                // Save preference\r\n                localStorage.setItem('classengage_view_mode', 'list');\r\n            });\r\n            \r\n            // Restore saved preference\r\n            const savedView = localStorage.getItem('classengage_view_mode');\r\n            if (savedView === 'list') {\r\n                listViewBtn.trigger('click');\r\n            }\r\n        };\r\n        \r\n        // Card Hover Effects\r\n        const initCardEffects = () => {\r\n            $('.classengage-slide-card').hover(\r\n                function() {\r\n                    $(this).addClass('card-hover');\r\n                },\r\n                function() {\r\n                    $(this).removeClass('card-hover');\r\n                }\r\n            );\r\n        };\r\n        \r\n        // Preview Modal\r\n        const initPreviewModal = () => {\r\n            $('[data-toggle=\"modal\"][data-target=\"#preview-modal\"]').on('click', function() {\r\n                const slideId = $(this).data('slide-id');\r\n                const previewContent = $('#preview-content');\r\n                \r\n                // Get strings first\r\n                Promise.all([\r\n                    Str.get_string('loadingpreview', 'mod_classengage'),\r\n                    Str.get_string('previewnotavailable', 'mod_classengage'),\r\n                    Str.get_string('errorloadingpreview', 'mod_classengage')\r\n                ]).then(function(strings) {\r\n                    const [loadingStr, notAvailableStr, errorStr] = strings;\r\n                    \r\n                    // Show loading\r\n                    previewContent.html(\r\n                        '<div class=\"text-center p-5\">' +\r\n                        '<div class=\"classengage-loading\"></div>' +\r\n                        '<p class=\"mt-3 text-muted\">' + loadingStr + '</p>' +\r\n                        '</div>'\r\n                    );\r\n                    \r\n                    // Load preview via AJAX\r\n                    Ajax.call([{\r\n                        methodname: 'mod_classengage_get_slide_preview',\r\n                        args: {\r\n                            slideid: slideId,\r\n                            contextid: contextid\r\n                        }\r\n                    }])[0].then(function(response) {\r\n                        if (response.success) {\r\n                            previewContent.html(response.html);\r\n                        } else {\r\n                            previewContent.html(\r\n                                '<div class=\"alert alert-warning\">' +\r\n                                '<i class=\"fa fa-exclamation-triangle\"></i> ' +\r\n                                notAvailableStr +\r\n                                '</div>'\r\n                            );\r\n                        }\r\n                        return;\r\n                    }).catch(function(error) {\r\n                        previewContent.html(\r\n                            '<div class=\"alert alert-danger\">' +\r\n                            '<i class=\"fa fa-times-circle\"></i> ' +\r\n                            errorStr + ': ' + error.message +\r\n                            '</div>'\r\n                        );\r\n                        Notification.exception(error);\r\n                    });\r\n                    return;\r\n                }).catch(Notification.exception);\r\n            });\r\n        };\r\n        \r\n        // Smooth Scroll to Top\r\n        const initScrollToTop = () => {\r\n            const scrollBtn = $('<button>', {\r\n                id: 'scroll-to-top',\r\n                class: 'btn btn-primary',\r\n                html: '<i class=\"fa fa-arrow-up\"></i>',\r\n                css: {\r\n                    position: 'fixed',\r\n                    bottom: '30px',\r\n                    right: '30px',\r\n                    display: 'none',\r\n                    'z-index': 1000,\r\n                    'border-radius': '50%',\r\n                    width: '50px',\r\n                    height: '50px',\r\n                    'box-shadow': '0 4px 12px rgba(0,0,0,0.15)'\r\n                }\r\n            });\r\n            \r\n            $('body').append(scrollBtn);\r\n            \r\n            $(window).on('scroll', function() {\r\n                if ($(this).scrollTop() > 300) {\r\n                    scrollBtn.fadeIn(300);\r\n                } else {\r\n                    scrollBtn.fadeOut(300);\r\n                }\r\n            });\r\n            \r\n            scrollBtn.on('click', function() {\r\n                $('html, body').animate({scrollTop: 0}, 600);\r\n            });\r\n        };\r\n        \r\n        // Keyboard Shortcuts\r\n        const initKeyboardShortcuts = () => {\r\n            $(document).on('keydown', function(e) {\r\n                // Ctrl/Cmd + F: Focus search\r\n                if ((e.ctrlKey || e.metaKey) && e.key === 'f') {\r\n                    e.preventDefault();\r\n                    $('#slide-search').focus();\r\n                }\r\n                \r\n                // Ctrl/Cmd + A: Select all (when not in input)\r\n                if ((e.ctrlKey || e.metaKey) && e.key === 'a' && !$(e.target).is('input, textarea')) {\r\n                    e.preventDefault();\r\n                    $('#select-all-slides').prop('checked', true).trigger('change');\r\n                }\r\n                \r\n                // Escape: Clear selection\r\n                if (e.key === 'Escape') {\r\n                    $('#cancel-selection-btn').trigger('click');\r\n                }\r\n            });\r\n        };\r\n        \r\n        // Tooltips\r\n        const initTooltips = () => {\r\n            $('[title]').tooltip({\r\n                placement: 'top',\r\n                trigger: 'hover',\r\n                delay: {show: 500, hide: 100}\r\n            });\r\n        };\r\n        \r\n        // Progress Indicators\r\n        const initProgressIndicators = () => {\r\n            // Add progress bars to cards with processing status\r\n            $('.slide-item[data-slide-status=\"processing\"]').each(function() {\r\n                const card = $(this).find('.classengage-card-body');\r\n                card.append(\r\n                    '<div class=\"progress mt-3\" style=\"height: 4px;\">' +\r\n                    '<div class=\"progress-bar progress-bar-striped progress-bar-animated\" ' +\r\n                    'role=\"progressbar\" style=\"width: 100%\"></div>' +\r\n                    '</div>'\r\n                );\r\n            });\r\n        };\r\n        \r\n        // Auto-refresh for processing slides\r\n        const initAutoRefresh = () => {\r\n            const processingSlides = $('.slide-item[data-slide-status=\"processing\"]');\r\n            \r\n            if (processingSlides.length > 0) {\r\n                // Refresh every 10 seconds if there are processing slides\r\n                setTimeout(function() {\r\n                    location.reload();\r\n                }, 10000);\r\n            }\r\n        };\r\n        \r\n        // Initialize all features\r\n        initBulkSelection();\r\n        initSearch();\r\n        initStatusFilter();\r\n        initViewToggle();\r\n        initCardEffects();\r\n        initPreviewModal();\r\n        initScrollToTop();\r\n        initKeyboardShortcuts();\r\n        initTooltips();\r\n        initProgressIndicators();\r\n        initAutoRefresh();\r\n        \r\n        // Animate cards on load\r\n        $('.slide-item').each(function(index) {\r\n            $(this).css('animation-delay', (index * 0.05) + 's');\r\n        });\r\n    };\r\n    \r\n    return {\r\n        init: init\r\n    };\r\n});\r\n"],"names":["define","$","Ajax","Notification","Str","init","contextid","selectAll","checkboxes","bulkToolbar","bulkDeleteBtn","selectedCount","cancelBtn","updateBulkSelection","checkedCount","each","this","is","closest","addClass","removeClass","fadeIn","prop","get_string","then","str","text","catch","exception","fadeOut","on","initBulkSelection","searchTimeout","clearTimeout","searchTerm","val","toLowerCase","setTimeout","visibleCount","title","data","filename","includes","length","append","remove","initSearch","status","gridViewBtn","listViewBtn","slidesGrid","localStorage","setItem","getItem","trigger","initViewToggle","hover","slideId","previewContent","Promise","all","strings","loadingStr","notAvailableStr","errorStr","html","call","methodname","args","slideid","response","success","error","message","scrollBtn","id","class","css","position","bottom","right","display","width","height","window","scrollTop","animate","initScrollToTop","document","e","ctrlKey","metaKey","key","preventDefault","focus","target","tooltip","placement","delay","show","hide","find","location","reload","index"],"mappings":"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"}