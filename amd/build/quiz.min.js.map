{"version":3,"file":"quiz.min.js","sources":["../src/quiz.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for real-time quiz participation\n *\n * @module     mod_classengage/quiz\n * @package\n * @copyright  2025 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    var currentQuestion = null;\n    var pollingTimer = null;\n    var countdownTimer = null;\n\n    return {\n        init: function(cmid, sessionid, pollinginterval) {\n            var self = this;\n\n            // Start polling for updates\n            this.startPolling(sessionid, pollinginterval);\n\n            // Handle answer submission\n            $(document).on('click', '.submit-answer-btn', function() {\n                self.submitAnswer(sessionid);\n            });\n        },\n\n        startPolling: function(sessionid, interval) {\n            var self = this;\n\n            // Poll for current question\n            pollingTimer = setInterval(function() {\n                self.getCurrentQuestion(sessionid);\n            }, interval);\n\n            // Get initial question\n            this.getCurrentQuestion(sessionid);\n        },\n\n        getCurrentQuestion: function(sessionid) {\n            var self = this;\n\n            Ajax.call([{\n                methodname: 'mod_classengage_get_current_question',\n                args: {sessionid: sessionid},\n                done: function(response) {\n                    self.updateQuestionDisplay(response);\n                },\n                fail: function() {\n                    // Fallback to direct AJAX call\n                    $.ajax({\n                        url: M.cfg.wwwroot + '/mod/classengage/ajax.php',\n                        method: 'POST',\n                        data: {\n                            action: 'getcurrent',\n                            sessionid: sessionid,\n                            sesskey: M.cfg.sesskey\n                        },\n                        dataType: 'json',\n                        success: function(response) {\n                            self.updateQuestionDisplay(response);\n                        }\n                    });\n                }\n            }]);\n        },\n\n        updateQuestionDisplay: function(response) {\n            var container = $('#question-container');\n            var statusDiv = $('#quiz-status');\n\n            if (!response.success || response.status !== 'active') {\n                container.html('');\n                if (response.status === 'completed') {\n                    statusDiv.removeClass('alert-info').addClass('alert-success');\n                    statusDiv.html(M.util.get_string('quizcompleted', 'mod_classengage'));\n                    this.stopPolling();\n                } else {\n                    statusDiv.html(M.util.get_string('waitingnextquestion', 'mod_classengage'));\n                }\n                return;\n            }\n\n            var question = response.question;\n\n            if (!question) {\n                container.html('<p>' + M.util.get_string('waitingnextquestion', 'mod_classengage') + '</p>');\n                return;\n            }\n\n            // Check if this is a new question\n            if (currentQuestion === null || currentQuestion.id !== question.id) {\n                currentQuestion = question;\n                this.displayQuestion(question);\n            }\n\n            // Update timer\n            this.updateTimer(question.timeremaining);\n\n            // Update question number\n            statusDiv.html(M.util.get_string('currentquestion', 'mod_classengage', {\n                current: question.number,\n                total: question.total\n            }));\n        },\n\n        displayQuestion: function(question) {\n            var html = '<div class=\"question-text mb-4\">';\n            html += '<h4>' + question.text + '</h4>';\n            html += '</div>';\n\n            if (question.answered) {\n                html += '<div class=\"alert alert-info\">' + M.util.get_string('alreadyanswered', 'mod_classengage') + '</div>';\n            } else {\n                html += '<form id=\"answer-form\">';\n                html += '<div class=\"question-options\">';\n\n                for (var i = 0; i < question.options.length; i++) {\n                    var option = question.options[i];\n                    html += '<div class=\"quiz-option\">';\n                    html += '<label>';\n                    html += '<input type=\"radio\" name=\"answer\" value=\"' + option.key + '\" required> ';\n                    html += '<strong>' + option.key + '.</strong> ' + option.text;\n                    html += '</label>';\n                    html += '</div>';\n                }\n\n                html += '</div>';\n                html += '<button type=\"button\" class=\"btn btn-primary btn-lg submit-answer-btn mt-3\">';\n                html += M.util.get_string('submitanswer', 'mod_classengage');\n                html += '</button>';\n                html += '</form>';\n            }\n\n            $('#question-container').html(html);\n        },\n\n        updateTimer: function(seconds) {\n            var display = $('#timer-display');\n\n            if (seconds <= 0) {\n                display.text('0:00');\n                display.removeClass('warning').addClass('danger');\n                return;\n            }\n\n            var minutes = Math.floor(seconds / 60);\n            var secs = seconds % 60;\n            var timeStr = minutes + ':' + (secs < 10 ? '0' : '') + secs;\n\n            display.text(timeStr);\n\n            if (seconds <= 10) {\n                display.removeClass('warning').addClass('danger');\n            } else if (seconds <= 30) {\n                display.removeClass('danger').addClass('warning');\n            } else {\n                display.removeClass('warning danger');\n            }\n        },\n\n        submitAnswer: function(sessionid) {\n            var selectedAnswer = $('input[name=\"answer\"]:checked').val();\n\n            if (!selectedAnswer) {\n                Notification.alert(\n                    M.util.get_string('error'),\n                    M.util.get_string('selectanswer', 'mod_classengage')\n                );\n                return;\n            }\n\n            if (!currentQuestion) {\n                return;\n            }\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/classengage/ajax.php',\n                method: 'POST',\n                data: {\n                    action: 'submitanswer',\n                    sessionid: sessionid,\n                    questionid: currentQuestion.id,\n                    answer: selectedAnswer,\n                    sesskey: M.cfg.sesskey\n                },\n                dataType: 'json',\n                success: function(response) {\n                    if (response.success) {\n                        var message = response.iscorrect ?\n                            M.util.get_string('correct', 'mod_classengage') :\n                            M.util.get_string('incorrect', 'mod_classengage');\n\n                        $('#question-container').html(\n                            '<div class=\"alert alert-' + (response.iscorrect ? 'success' : 'warning') + '\">' +\n                            '<h4>' + message + '</h4>' +\n                            '<p>' + M.util.get_string('correctanswer', 'mod_classengage') + ': ' + response.correctanswer + '</p>' +\n                            '<p>' + M.util.get_string('waitingnextquestion', 'mod_classengage') + '</p>' +\n                            '</div>'\n                        );\n                    } else {\n                        Notification.exception({message: response.error || 'Error submitting answer'});\n                    }\n                },\n                error: function() {\n                    Notification.exception({message: 'Error submitting answer'});\n                }\n            });\n        },\n\n        stopPolling: function() {\n            if (pollingTimer) {\n                clearInterval(pollingTimer);\n                pollingTimer = null;\n            }\n            if (countdownTimer) {\n                clearInterval(countdownTimer);\n                countdownTimer = null;\n            }\n        }\n    };\n});\n\n"],"names":["define","$","Ajax","Notification","currentQuestion","pollingTimer","countdownTimer","init","cmid","sessionid","pollinginterval","self","this","startPolling","document","on","submitAnswer","interval","setInterval","getCurrentQuestion","call","methodname","args","done","response","updateQuestionDisplay","fail","ajax","url","M","cfg","wwwroot","method","data","action","sesskey","dataType","success","container","statusDiv","status","html","removeClass","addClass","util","get_string","stopPolling","question","id","displayQuestion","updateTimer","timeremaining","current","number","total","text","answered","i","options","length","option","key","seconds","display","secs","timeStr","Math","floor","selectedAnswer","val","questionid","answer","message","iscorrect","correctanswer","exception","error","alert","clearInterval"],"mappings":"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"}