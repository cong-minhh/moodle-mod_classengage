{"version":3,"file":"controlpanel.min.js","sources":["../src/controlpanel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for real-time instructor control panel\n *\n * SSE-only mode: Provides real-time student status monitoring, session control,\n * and aggregate statistics display exclusively via Server-Sent Events.\n * api.php is used only for write operations (pause/resume).\n *\n * Requirements: 1.3, 1.4, 1.5, 5.1, 5.4, 5.5\n *\n * @module     mod_classengage/controlpanel\n * @copyright  2025 Danielle\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification', 'mod_classengage/connection_manager'],\n    function ($, Notification, ConnectionManager) {\n\n        // SSE-only mode: No polling timers needed\n        var pollingInterval = 1000; // Used only for SSE connection options\n        var sessionId = null;\n        var chart = null;\n        var lastQuestionNumber = -1; // Track last known question to prevent stale updates\n\n        // Constants\n        var ANSWER_OPTIONS = ['A', 'B', 'C', 'D'];\n\n        // Session state\n        var isPaused = false;\n\n        // Connected students cache\n        var connectedStudents = {};\n\n        // Student search filter\n        var searchTerm = '';\n\n        // Client-side timer state (local countdown)\n        var timerState = {\n            timeRemaining: 0,       // Current time remaining\n            timelimit: 0,           // Total time limit\n            clientStartTime: 0,     // When local countdown started\n            isRunning: false,       // Whether countdown is active\n            countdownTimer: null,    // setInterval reference\n        };\n\n        return {\n            /**\n             * Initialize the control panel with real-time polling and SSE\n             *\n             * @param {number} sid Session ID\n             * @param {number} interval Polling interval in milliseconds\n             */\n            init: function (sid, interval) {\n                // eslint-disable-next-line no-console\n                console.log('Control panel init called with sessionId:', sid, 'interval:', interval);\n\n                sessionId = sid;\n                pollingInterval = interval || 1000;\n\n                // Initialize SSE connection (SSE-only, no polling fallback for stats)\n                this.initSSEConnection();\n\n                // Initialize chart\n                this.initChart();\n\n                // Setup pause/resume controls\n                this.setupSessionControls();\n\n                // Add cleanup on page unload\n                this.setupUnloadHandler();\n            },\n\n            /**\n             * Initialize SSE connection for real-time updates (SSE-ONLY MODE)\n             *\n             * @private\n             */\n            initSSEConnection: function () {\n                var self = this;\n\n                // Setup student search functionality\n                this.setupStudentSearch();\n\n                // Register event handlers before connecting\n                ConnectionManager.on('session_paused', function (data) {\n                    self.handleSessionPaused(data);\n                });\n\n                ConnectionManager.on('session_resumed', function (data) {\n                    self.handleSessionResumed(data);\n                });\n\n                ConnectionManager.on('question_broadcast', function (data) {\n                    self.handleQuestionBroadcast(data);\n                });\n\n                ConnectionManager.on('state_update', function (data) {\n                    self.handleStateUpdate(data);\n                });\n\n                ConnectionManager.on('statuschange', function (data) {\n                    self.handleConnectionStatusChange(data);\n                });\n\n                // SSE-ONLY: Register handlers for stats and students updates\n                ConnectionManager.on('stats_update', function (data) {\n                    self.handleStatsUpdate(data);\n                });\n\n                ConnectionManager.on('students_update', function (data) {\n                    self.handleStudentsUpdate(data);\n                });\n\n                // Try to connect via SSE\n                ConnectionManager.init(sessionId, {\n                    pollInterval: pollingInterval,\n                }).then(function () {\n                    // Log actual transport being used\n                    var status = ConnectionManager.getInstance().getStatus();\n                    // eslint-disable-next-line no-console\n                    console.log('Connection established for control panel:', {\n                        transport: status.transport,\n                        status: status.status,\n                        connectionId: status.connectionId,\n                    });\n\n                    if (status.transport === 'sse') {\n                        // eslint-disable-next-line no-console\n                        console.log('✓ SSE-ONLY mode active - No polling required!');\n                    } else {\n                        // eslint-disable-next-line no-console\n                        console.warn('⚠ SSE failed - Updates may not work correctly');\n                    }\n                    return null;\n                }).catch(function (error) {\n                    // eslint-disable-next-line no-console\n                    console.error('SSE connection failed:', error);\n                });\n            },\n\n            /**\n             * Handle stats update from SSE (replaces AJAX polling)\n             *\n             * @param {Object} data Stats data from SSE\n             * @private\n             */\n            handleStatsUpdate: function (data) {\n                // Debug: Log received SSE stats data\n                // eslint-disable-next-line no-console\n                console.log('SSE stats_update received:', {\n                    currentquestion: data.currentquestion,\n                    responses: data.responses,\n                    distribution: data.distribution,\n                    hasChart: !!chart,\n                });\n\n                // Sync local timer with server time (if changed significantly)\n                if (data.timelimit > 0 && data.timeremaining !== undefined) {\n                    this.syncLocalTimer(data.timelimit, data.timeremaining);\n                }\n\n                // Update display with ALL stats data from SSE\n                this.updateDisplay({\n                    currentquestion: data.currentquestion,\n                    totalquestions: data.totalquestions,\n                    responses: data.responses,\n                    participants: data.participants,\n                    participationrate: data.participationrate,\n                    status: data.status,\n                    timelimit: data.timelimit,\n                    timeremaining: data.timeremaining,\n                    distribution: data.distribution,\n                    connected: data.connected,\n                    answered: data.answered,\n                    pending: data.pending,\n                });\n            },\n\n            /**\n             * Handle students update from SSE (replaces AJAX polling)\n             *\n             * @param {Object} data Students data from SSE\n             * @private\n             */\n            handleStudentsUpdate: function (data) {\n                // Update student list\n                if (data.students) {\n                    this.updateStudentList(data.students);\n                }\n                // Update aggregate stats\n                if (data.stats) {\n                    this.updateAggregateStats(data.stats);\n                }\n            },\n\n            // NOTE: stopPolling removed - SSE-only mode\n\n            /**\n             * Setup page unload handler to disconnect SSE\n             *\n             * @private\n             */\n            setupUnloadHandler: function () {\n                $(window).on('beforeunload', function () {\n                    // SSE-only: Just disconnect the connection manager\n                    ConnectionManager.disconnect();\n                });\n            },\n\n            /**\n             * Setup pause/resume session controls\n             *\n             * Requirements: 1.4, 1.5\n             * @private\n             */\n            setupSessionControls: function () {\n                var self = this;\n\n                // Pause button handler\n                $(document).on('click', '#btn-pause-session', function (e) {\n                    e.preventDefault();\n                    self.pauseSession();\n                });\n\n                // Resume button handler\n                $(document).on('click', '#btn-resume-session', function (e) {\n                    e.preventDefault();\n                    self.resumeSession();\n                });\n            },\n\n\n            /**\n             * Setup student search functionality with debouncing\n             *\n             * @private\n             */\n            setupStudentSearch: function () {\n                var self = this;\n                var searchTimer = null;\n\n                $('#student-search').on('input', function () {\n                    var value = $(this).val().toLowerCase().trim();\n\n                    // Debounce: wait 150ms before filtering\n                    if (searchTimer) {\n                        clearTimeout(searchTimer);\n                    }\n                    searchTimer = setTimeout(function () {\n                        searchTerm = value;\n                        self.filterStudentList();\n                    }, 150);\n                });\n            },\n\n            /**\n             * Filter and re-render student list based on search term\n             *\n             * @private\n             */\n            filterStudentList: function () {\n                var container = $('#student-list');\n                if (!container.length) {\n                    return;\n                }\n\n                // Get all students from cache\n                var students = Object.values(connectedStudents);\n\n                // Filter by search term\n                if (searchTerm) {\n                    students = students.filter(function (student) {\n                        var name = (student.fullname || '').toLowerCase();\n                        return name.indexOf(searchTerm) !== -1;\n                    });\n                }\n\n                // Re-render filtered list\n                this.renderStudentListHtml(students);\n            },\n\n            /**\n             * Pause the current session\n             *\n             * Requirement: 1.4 - Freeze timer and prevent new submissions\n             * @private\n             */\n            pauseSession: function () {\n                var self = this;\n\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/classengage/api.php',\n                    method: 'POST',\n                    data: {\n                        action: 'pause',\n                        sessionid: sessionId,\n                        sesskey: M.cfg.sesskey,\n                    },\n                    dataType: 'json',\n                    success: function (response) {\n                        if (response.success) {\n                            self.handleSessionPaused(response);\n                            Notification.addNotification({\n                                message: M.util.get_string('sessionpaused', 'mod_classengage'),\n                                type: 'info',\n                            });\n                        } else {\n                            Notification.addNotification({\n                                message: response.error || 'Failed to pause session',\n                                type: 'error',\n                            });\n                        }\n                    },\n                    error: function () {\n                        Notification.addNotification({\n                            message: 'Network error while pausing session',\n                            type: 'error',\n                        });\n                    },\n                });\n            },\n\n            /**\n             * Resume the paused session\n             *\n             * Requirement: 1.5 - Restore timer and re-enable submissions\n             * @private\n             */\n            resumeSession: function () {\n                var self = this;\n\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/classengage/api.php',\n                    method: 'POST',\n                    data: {\n                        action: 'resume',\n                        sessionid: sessionId,\n                        sesskey: M.cfg.sesskey,\n                    },\n                    dataType: 'json',\n                    success: function (response) {\n                        if (response.success) {\n                            self.handleSessionResumed(response);\n                            Notification.addNotification({\n                                message: M.util.get_string('sessionresumed', 'mod_classengage'),\n                                type: 'info',\n                            });\n                        } else {\n                            Notification.addNotification({\n                                message: response.error || 'Failed to resume session',\n                                type: 'error',\n                            });\n                        }\n                    },\n                    error: function () {\n                        Notification.addNotification({\n                            message: 'Network error while resuming session',\n                            type: 'error',\n                        });\n                    },\n                });\n            },\n\n            /**\n             * Handle session paused event\n             *\n             * @param {Object} data Pause event data\n             * @private\n             */\n            handleSessionPaused: function (data) {\n                isPaused = true;\n\n                // Stop local timer and store remaining time\n                if (timerState.isRunning) {\n                    var clientElapsed = (Date.now() - timerState.clientStartTime) / 1000;\n                    timerState.timeRemaining = Math.max(0, timerState.timeRemaining - clientElapsed);\n                }\n                this.stopLocalCountdown();\n\n                // Update UI\n                $('#btn-pause-session').hide();\n                $('#btn-resume-session').show();\n                $('#session-status').text('Paused').addClass('text-warning');\n                $('#session-status-badge').removeClass('badge-success').addClass('badge-warning').text('Paused');\n\n                // Update timer display with frozen time\n                if (data.timerremaining !== undefined) {\n                    timerState.timeRemaining = data.timerremaining;\n                    this.renderTimerDisplay(data.timerremaining);\n                }\n                $('#time-display').addClass('text-warning');\n            },\n\n            /**\n             * Handle session resumed event\n             *\n             * @param {Object} data Resume event data\n             * @private\n             */\n            handleSessionResumed: function (data) {\n                isPaused = false;\n\n                // Update UI\n                $('#btn-resume-session').hide();\n                $('#btn-pause-session').show();\n                $('#session-status').text('Active').removeClass('text-warning');\n                $('#session-status-badge').removeClass('badge-warning').addClass('badge-success').text('Active');\n                $('#time-display').removeClass('text-warning');\n\n                // Resume timer with remaining time\n                var remaining = (data && data.timerremaining !== undefined) ? data.timerremaining : timerState.timeRemaining;\n                if (remaining > 0) {\n                    this.startLocalCountdown(remaining, timerState.timelimit);\n                }\n            },\n\n            /**\n             * Handle question broadcast event\n             *\n             * @param {Object} data Question broadcast data\n             * @private\n             */\n            handleQuestionBroadcast: function (data) {\n                // Reset student answered status for new question\n                this.resetStudentAnsweredStatus();\n\n                // Update question progress\n                if (data.questionnumber !== undefined) {\n                    var newQuestion = parseInt(data.questionnumber);\n                    lastQuestionNumber = newQuestion; // Update version tracker to prevent stale overwrites\n\n                    var total = $('#question-progress').data('total') || data.questionnumber + 1;\n                    $('#question-progress').text((newQuestion + 1) + ' / ' + total);\n                }\n\n                // Start fresh timer for new question\n                if (data.timelimit && data.timelimit > 0) {\n                    this.startLocalCountdown(data.timelimit, data.timelimit);\n                }\n\n                // NOTE: Stats will be pushed via SSE stats_update event - no manual refresh needed\n            },\n\n            /**\n             * Handle state update from polling\n             *\n             * @param {Object} data State update data\n             * @private\n             */\n            handleStateUpdate: function (data) {\n                if (data.status) {\n                    isPaused = (data.status === 'paused');\n\n                    if (isPaused) {\n                        $('#btn-pause-session').hide();\n                        $('#btn-resume-session').show();\n                    } else {\n                        $('#btn-resume-session').hide();\n                        $('#btn-pause-session').show();\n                    }\n                }\n            },\n\n            /**\n             * Handle connection status change\n             *\n             * @param {Object} data Status change data\n             * @private\n             */\n            handleConnectionStatusChange: function (data) {\n                var statusIndicator = $('#connection-status-indicator');\n                if (data.status === 'connected') {\n                    statusIndicator.removeClass('text-danger text-warning').addClass('text-success');\n                    statusIndicator.attr('title', 'Connected via ' + (data.transport || 'polling'));\n                } else if (data.status === 'reconnecting') {\n                    statusIndicator.removeClass('text-success text-danger').addClass('text-warning');\n                    statusIndicator.attr('title', 'Reconnecting...');\n                } else {\n                    statusIndicator.removeClass('text-success text-warning').addClass('text-danger');\n                    statusIndicator.attr('title', 'Disconnected');\n                }\n            },\n\n            // NOTE: Student status polling removed - SSE provides students_update events now\n\n            /**\n             * Update the connected students list display\n             *\n             * Requirement: 5.1 - Display list of connected students with status\n             * @param {Array} students Array of student objects\n             * @private\n             */\n            updateStudentList: function (students) {\n                var container = $('#student-list');\n                if (!container.length) {\n                    return;\n                }\n\n                // Update cache\n                students.forEach(function (student) {\n                    connectedStudents[student.userid] = student;\n                });\n\n                // Filter students based on search term\n                var filteredStudents = students;\n                if (searchTerm) {\n                    filteredStudents = students.filter(function (student) {\n                        var name = (student.fullname || '').toLowerCase();\n                        return name.indexOf(searchTerm) !== -1;\n                    });\n                }\n\n                // Render filtered list\n                this.renderStudentListHtml(filteredStudents);\n            },\n\n            /**\n             * Render student list HTML\n             *\n             * @param {Array} students Array of student objects to render\n             * @private\n             */\n            renderStudentListHtml: function (students) {\n                var self = this;\n                var container = $('#student-list');\n                if (!container.length) {\n                    return;\n                }\n\n                // Build simple student list HTML\n                var html = '';\n                if (students.length === 0) {\n                    html = '<div class=\"text-muted p-3 text-center\">' +\n                        (searchTerm ? 'No students match your search' : 'No students enrolled') + '</div>';\n                } else {\n                    html = '<ul class=\"list-group list-group-flush\">';\n                    students.forEach(function (student) {\n                        // Icon: check for answered, circle for pending\n                        var icon = student.hasanswered ? 'fa-check-circle text-success' : 'fa-circle text-muted';\n                        var name = self.escapeHtml(student.fullname || 'User ' + student.userid);\n\n                        // Visual distinction for non-connected students\n                        var isConnected = student.status !== 'not_connected';\n                        var nameClass = isConnected ? '' : 'text-muted';\n                        var itemClass = isConnected ? '' : 'bg-light';\n\n                        html += '<li class=\"list-group-item d-flex justify-content-between align-items-center py-2 ' +\n                            itemClass + '\" data-userid=\"' + student.userid + '\">';\n                        html += '<span class=\"' + nameClass + '\">' + name + '</span>';\n                        html += '<i class=\"fa ' + icon + '\"></i>';\n                        html += '</li>';\n                    });\n                    html += '</ul>';\n                }\n\n                container.html(html);\n            },\n\n            /**\n             * Get CSS class for student status\n             *\n             * @param {string} status Student connection status\n             * @return {string} CSS class\n             * @private\n             */\n            getStatusClass: function (status) {\n                switch (status) {\n                case 'connected':\n                    return 'text-success';\n                case 'disconnected':\n                    return 'text-danger';\n                case 'answering':\n                    return 'text-info';\n                default:\n                    return 'text-muted';\n                }\n            },\n\n            /**\n             * Get Font Awesome icon for student status\n             *\n             * @param {string} status Student connection status\n             * @param {boolean} hasAnswered Whether student has answered\n             * @return {string} FA icon class\n             * @private\n             */\n            getStatusIcon: function (status, hasAnswered) {\n                if (hasAnswered) {\n                    return 'fa-check-circle';\n                }\n                switch (status) {\n                case 'connected':\n                    return 'fa-circle';\n                case 'disconnected':\n                    return 'fa-times-circle';\n                case 'answering':\n                    return 'fa-spinner fa-spin';\n                default:\n                    return 'fa-question-circle';\n                }\n            },\n\n            /**\n             * Update aggregate statistics display\n             *\n             * @param {Object} stats Statistics object\n             * @private\n             */\n            updateAggregateStats: function (stats) {\n                // Stats are now shown in the Participants card, not in the Students panel\n                // This function is kept for backwards compatibility but does nothing\n                void stats;\n            },\n\n            /**\n             * Reset student answered status for new question\n             *\n             * @private\n             */\n            resetStudentAnsweredStatus: function () {\n                // Reset cache\n                Object.keys(connectedStudents).forEach(function (userid) {\n                    connectedStudents[userid].hasanswered = false;\n                });\n            },\n\n            /**\n             * Escape HTML to prevent XSS\n             *\n             * @param {string} text Text to escape\n             * @return {string} Escaped text\n             * @private\n             */\n            escapeHtml: function (text) {\n                var div = document.createElement('div');\n                div.textContent = text;\n                return div.innerHTML;\n            },\n\n            // NOTE: Stats polling removed - SSE provides stats_update events now\n            // NOTE: handleError removed - not needed in SSE-only mode\n\n            /**\n             * Update the display with new session data\n             *\n             * @param {Object} data Session statistics data\n             * @private\n             */\n            updateDisplay: function (data) {\n                // NOTE: participant-count (denominator) is set on page load from enrolled students\n                // and should NOT be updated dynamically - it represents total enrolled students\n\n                // Update question progress\n                if (data.currentquestion !== undefined && data.totalquestions !== undefined) {\n                    var newQuestion = parseInt(data.currentquestion);\n\n                    // Prevent flickering: only update if question number is same or newer\n                    if (newQuestion >= lastQuestionNumber) {\n                        lastQuestionNumber = newQuestion;\n                        $('#question-progress').text((newQuestion + 1) + ' / ' + data.totalquestions);\n                        $('#question-progress').data('total', data.totalquestions);\n                    }\n                }\n\n                // Update response count (current/total format in participants card)\n                if (data.responses !== undefined) {\n                    $('#response-count-current').text(data.responses);\n                    $('#response-count').text(data.responses + ' / ' + data.participants);\n                }\n\n                // Update connection statistics (Requirement 5.5)\n                if (data.connected !== undefined) {\n                    this.updateAggregateStats({\n                        connected: data.connected,\n                        answered: data.answered,\n                        pending: data.pending,\n                    });\n                }\n\n                // Update answer distribution\n                if (data.distribution) {\n                    this.updateDistribution(data.distribution);\n\n                    if (chart) {\n                        this.updateChart(data.distribution);\n                    }\n                }\n\n                // Update session status\n                if (data.status) {\n                    isPaused = (data.status === 'paused');\n\n                    var statusText = data.status.charAt(0).toUpperCase() + data.status.slice(1);\n                    $('#session-status').text(statusText);\n\n                    // Update pause/resume buttons\n                    if (isPaused) {\n                        $('#btn-pause-session').hide();\n                        $('#btn-resume-session').show();\n                        $('#session-status-badge').removeClass('badge-success').addClass('badge-warning');\n                    } else if (data.status === 'active') {\n                        $('#btn-resume-session').hide();\n                        $('#btn-pause-session').show();\n                        $('#session-status-badge').removeClass('badge-warning').addClass('badge-success');\n                    }\n\n                    // Stop polling if session is completed\n                    if (data.status === 'completed') {\n                        this.stopPolling();\n                        this.stopStudentStatusPolling();\n                    }\n                }\n\n                // Update time display\n                this.updateTimeDisplay(data);\n            },\n\n            /**\n             * Update the time display (uses local timer state)\n             *\n             * @param {Object} data Session data\n             * @private\n             */\n            updateTimeDisplay: function (data) {\n                // Local timer handles display updates via startLocalCountdown\n                // This method is called from updateDisplay but timer runs independently\n                if (data.timelimit > 0 && !timerState.isRunning && !isPaused) {\n                    var remaining = data.timeremaining !== undefined ? data.timeremaining : 0;\n                    if (remaining > 0) {\n                        this.startLocalCountdown(remaining, data.timelimit);\n                    }\n                }\n            },\n\n            /**\n             * Sync local timer with server time\n             *\n             * @param {number} timelimit Total time limit\n             * @param {number} serverRemaining Server's time remaining\n             * @private\n             */\n            syncLocalTimer: function (timelimit, serverRemaining) {\n                if (!timerState.isRunning) {\n                    // Start timer if not running\n                    this.startLocalCountdown(serverRemaining, timelimit);\n                    return;\n                }\n\n                // Calculate client's remaining time\n                var clientElapsed = (Date.now() - timerState.clientStartTime) / 1000;\n                var clientRemaining = Math.max(0, timerState.timeRemaining - clientElapsed);\n\n                // Only sync if drift > 2 seconds\n                var drift = Math.abs(serverRemaining - clientRemaining);\n                if (drift > 2) {\n                    // eslint-disable-next-line no-console\n                    console.log('Timer drift correction:', drift.toFixed(1), 'seconds');\n                    timerState.timeRemaining = serverRemaining;\n                    timerState.clientStartTime = Date.now();\n                }\n            },\n\n            /**\n             * Start local countdown timer\n             *\n             * @param {number} seconds Initial seconds remaining\n             * @param {number} timelimit Total time limit\n             * @private\n             */\n            startLocalCountdown: function (seconds, timelimit) {\n                var self = this;\n\n                // Stop any existing countdown\n                this.stopLocalCountdown();\n\n                // Initialize timer state\n                timerState.timeRemaining = seconds;\n                timerState.timelimit = timelimit;\n                timerState.clientStartTime = Date.now();\n                timerState.isRunning = true;\n\n                // Update display immediately\n                this.renderTimerDisplay(seconds);\n\n                // Start client-side countdown (1 second interval for instructor panel)\n                timerState.countdownTimer = setInterval(function () {\n                    if (!timerState.isRunning || isPaused) {\n                        return;\n                    }\n\n                    // Calculate elapsed time on client\n                    var clientElapsed = (Date.now() - timerState.clientStartTime) / 1000;\n                    var remaining = Math.max(0, timerState.timeRemaining - clientElapsed);\n\n                    self.renderTimerDisplay(remaining);\n\n                    // Stop when timer reaches 0\n                    if (remaining <= 0) {\n                        self.stopLocalCountdown();\n                    }\n                }, 1000); // 1 second updates for instructor panel\n            },\n\n            /**\n             * Stop local countdown timer\n             * @private\n             */\n            stopLocalCountdown: function () {\n                if (timerState.countdownTimer) {\n                    clearInterval(timerState.countdownTimer);\n                    timerState.countdownTimer = null;\n                }\n                timerState.isRunning = false;\n            },\n\n            /**\n             * Render timer display\n             *\n             * @param {number} remaining Seconds remaining\n             * @private\n             */\n            renderTimerDisplay: function (remaining) {\n                var timeText = this.formatTime(remaining);\n                var timeDisplay = $('#time-display');\n\n                timeDisplay.text(timeText);\n\n                if (remaining <= 0) {\n                    timeDisplay.removeClass('text-warning').addClass('text-danger font-weight-bold');\n                } else if (remaining < 10) {\n                    timeDisplay.removeClass('text-warning').addClass('text-danger font-weight-bold');\n                } else if (remaining < 30) {\n                    timeDisplay.removeClass('text-danger font-weight-bold').addClass('text-warning');\n                } else {\n                    timeDisplay.removeClass('text-danger text-warning font-weight-bold');\n                }\n            },\n\n            /**\n             * Format seconds into MM:SS\n             *\n             * @param {number} seconds Seconds to format\n             * @return {string} Formatted time string\n             * @private\n             */\n            formatTime: function (seconds) {\n                var m = Math.floor(seconds / 60);\n                var s = Math.floor(seconds % 60);\n                return (m < 10 ? '0' + m : m) + ':' + (s < 10 ? '0' + s : s);\n            },\n\n            /**\n             * Update the answer distribution table\n             *\n             * @param {Object} distribution Distribution data with A, B, C, D counts\n             * @private\n             */\n            updateDistribution: function (distribution) {\n                var total = distribution.total || 0;\n                var correctAnswer = distribution.correctanswer || '';\n\n                ANSWER_OPTIONS.forEach(function (option) {\n                    var count = distribution[option] || 0;\n                    var percentage = total > 0 ? Math.round((count / total) * 100) : 0;\n                    var isCorrect = option === correctAnswer.toUpperCase();\n\n                    // Update count\n                    var countElem = $('#count-' + option);\n                    if (countElem.length) {\n                        countElem.text(count);\n                    }\n\n                    // Update percentage\n                    var percentElem = $('#percent-' + option);\n                    if (percentElem.length) {\n                        percentElem.text(percentage + '%');\n                    }\n\n                    // Update progress bar\n                    var progressBar = $('#bar-' + option);\n                    if (progressBar.length) {\n                        progressBar.css('width', percentage + '%');\n                        progressBar.attr('aria-valuenow', percentage);\n                    }\n\n                    // Highlight correct answer\n                    var row = $('#row-' + option);\n                    if (row.length) {\n                        if (isCorrect) {\n                            row.addClass('table-success');\n                            progressBar.removeClass('bg-info').addClass('bg-success');\n                        } else {\n                            row.removeClass('table-success');\n                            progressBar.removeClass('bg-success').addClass('bg-info');\n                        }\n                    }\n                });\n            },\n\n            /**\n             * Initialize Chart.js bar chart for response visualization\n             *\n             * @private\n             */\n            initChart: function () {\n                var ctx = document.getElementById('responseChart');\n                if (!ctx) {\n                    return;\n                }\n\n                // Check if Chart.js loaded successfully\n                if (typeof window.Chart === 'undefined') {\n                    // eslint-disable-next-line no-console\n                    console.error('Chart.js failed to load. Displaying table view only.');\n                    return;\n                }\n\n                chart = new window.Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ANSWER_OPTIONS,\n                        datasets: [{\n                            label: 'Responses',\n                            data: [0, 0, 0, 0],\n                            backgroundColor: [\n                                'rgba(54, 162, 235, 0.8)',\n                                'rgba(54, 162, 235, 0.8)',\n                                'rgba(54, 162, 235, 0.8)',\n                                'rgba(54, 162, 235, 0.8)',\n                            ],\n                            borderColor: [\n                                'rgba(54, 162, 235, 1)',\n                                'rgba(54, 162, 235, 1)',\n                                'rgba(54, 162, 235, 1)',\n                                'rgba(54, 162, 235, 1)',\n                            ],\n                            borderWidth: 1,\n                        }],\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                ticks: {\n                                    stepSize: 1,\n                                },\n                            },\n                        },\n                        plugins: {\n                            legend: {\n                                display: false,\n                            },\n                            title: {\n                                display: true,\n                                text: 'Response Distribution',\n                            },\n                        },\n                    },\n                });\n            },\n\n            /**\n             * Update chart with new distribution data\n             *\n             * @param {Object} distribution Distribution data with A, B, C, D counts\n             * @private\n             */\n            updateChart: function (distribution) {\n                if (!chart) {\n                    return;\n                }\n\n                var data = ANSWER_OPTIONS.map(function (option) {\n                    return distribution[option] || 0;\n                });\n\n                var correctAnswer = distribution.correctanswer || '';\n                var colors = ANSWER_OPTIONS.map(function (option) {\n                    return option === correctAnswer.toUpperCase() ?\n                        'rgba(75, 192, 192, 0.8)' : 'rgba(54, 162, 235, 0.8)';\n                });\n\n                var borderColors = ANSWER_OPTIONS.map(function (option) {\n                    return option === correctAnswer.toUpperCase() ?\n                        'rgba(75, 192, 192, 1)' : 'rgba(54, 162, 235, 1)';\n                });\n\n                chart.data.datasets[0].data = data;\n                chart.data.datasets[0].backgroundColor = colors;\n                chart.data.datasets[0].borderColor = borderColors;\n                chart.update('none');\n            },\n\n        };\n    });\n"],"names":["define","$","Notification","ConnectionManager","pollingInterval","sessionId","chart","lastQuestionNumber","ANSWER_OPTIONS","isPaused","connectedStudents","searchTerm","timerState","timeRemaining","timelimit","clientStartTime","isRunning","countdownTimer","init","sid","interval","console","log","initSSEConnection","initChart","setupSessionControls","setupUnloadHandler","self","this","setupStudentSearch","on","data","handleSessionPaused","handleSessionResumed","handleQuestionBroadcast","handleStateUpdate","handleConnectionStatusChange","handleStatsUpdate","handleStudentsUpdate","pollInterval","then","status","getInstance","getStatus","transport","connectionId","warn","catch","error","currentquestion","responses","distribution","hasChart","undefined","timeremaining","syncLocalTimer","updateDisplay","totalquestions","participants","participationrate","connected","answered","pending","students","updateStudentList","stats","updateAggregateStats","window","disconnect","document","e","preventDefault","pauseSession","resumeSession","searchTimer","value","val","toLowerCase","trim","clearTimeout","setTimeout","filterStudentList","length","Object","values","filter","student","fullname","indexOf","renderStudentListHtml","ajax","url","M","cfg","wwwroot","method","action","sessionid","sesskey","dataType","success","response","addNotification","message","util","get_string","type","clientElapsed","Date","now","Math","max","stopLocalCountdown","hide","show","text","addClass","removeClass","timerremaining","renderTimerDisplay","remaining","startLocalCountdown","resetStudentAnsweredStatus","questionnumber","newQuestion","parseInt","total","statusIndicator","attr","forEach","userid","filteredStudents","container","html","icon","hasanswered","name","escapeHtml","isConnected","nameClass","getStatusClass","getStatusIcon","hasAnswered","keys","div","createElement","textContent","innerHTML","updateDistribution","updateChart","statusText","charAt","toUpperCase","slice","stopPolling","stopStudentStatusPolling","updateTimeDisplay","serverRemaining","clientRemaining","drift","abs","toFixed","seconds","setInterval","clearInterval","timeText","formatTime","timeDisplay","m","floor","s","correctAnswer","correctanswer","option","count","percentage","round","isCorrect","countElem","percentElem","progressBar","css","row","ctx","getElementById","Chart","labels","datasets","label","backgroundColor","borderColor","borderWidth","options","responsive","maintainAspectRatio","scales","y","beginAtZero","ticks","stepSize","plugins","legend","display","title","map","colors","borderColors","update"],"mappings":"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"}