{"version":3,"file":"controlpanel.min.js","sources":["../src/controlpanel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * JavaScript for real-time instructor control panel\r\n *\r\n * Provides real-time student status monitoring, session control (pause/resume),\r\n * and aggregate statistics display via SSE with polling fallback.\r\n *\r\n * Requirements: 1.3, 1.4, 1.5, 5.1, 5.4, 5.5\r\n *\r\n * @module     mod_classengage/controlpanel\r\n * @copyright  2025 Danielle\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/notification', 'mod_classengage/connection_manager'],\r\n    function ($, Notification, ConnectionManager) {\r\n\r\n        var pollingTimer = null;\r\n        var pollingInterval = 1000; // 1 second\r\n        var sessionId = null;\r\n        var chart = null;\r\n        var consecutiveFailures = 0;\r\n        var warningDisplayed = false;\r\n        var lastQuestionNumber = -1; // Track last known question to prevent stale updates\r\n\r\n        // Constants\r\n        var MAX_CONSECUTIVE_FAILURES = 5;\r\n\r\n        var ANSWER_OPTIONS = ['A', 'B', 'C', 'D'];\r\n        var STUDENT_STATUS_UPDATE_INTERVAL = 2000; // 2 seconds (Requirement 1.3)\r\n\r\n        // Session state\r\n        var isPaused = false;\r\n\r\n        // SSE connection state\r\n        var studentStatusTimer = null;\r\n\r\n        // Connected students cache\r\n        var connectedStudents = {};\r\n\r\n        return {\r\n            /**\r\n             * Initialize the control panel with real-time polling and SSE\r\n             *\r\n             * @param {number} sid Session ID\r\n             * @param {number} interval Polling interval in milliseconds\r\n             */\r\n            init: function (sid, interval) {\r\n                // eslint-disable-next-line no-console\r\n                console.log('Control panel init called with sessionId:', sid, 'interval:', interval);\r\n\r\n                sessionId = sid;\r\n                pollingInterval = interval || 1000;\r\n\r\n                // Initialize connection manager for SSE\r\n                this.initSSEConnection();\r\n\r\n                // Start polling for updates (fallback and stats)\r\n                this.startPolling();\r\n\r\n                // Start student status polling\r\n                this.startStudentStatusPolling();\r\n\r\n                // Initialize chart\r\n                this.initChart();\r\n\r\n                // Setup pause/resume controls\r\n                this.setupSessionControls();\r\n\r\n                // Add cleanup on page unload\r\n                this.setupUnloadHandler();\r\n            },\r\n\r\n            /**\r\n             * Initialize SSE connection for real-time updates\r\n             *\r\n             * @private\r\n             */\r\n            initSSEConnection: function () {\r\n                var self = this;\r\n\r\n                // Register event handlers before connecting\r\n                ConnectionManager.on('session_paused', function (data) {\r\n                    self.handleSessionPaused(data);\r\n                });\r\n\r\n                ConnectionManager.on('session_resumed', function (data) {\r\n                    self.handleSessionResumed(data);\r\n                });\r\n\r\n                ConnectionManager.on('question_broadcast', function (data) {\r\n                    self.handleQuestionBroadcast(data);\r\n                });\r\n\r\n                ConnectionManager.on('state_update', function (data) {\r\n                    self.handleStateUpdate(data);\r\n                });\r\n\r\n                ConnectionManager.on('statuschange', function (data) {\r\n                    self.handleConnectionStatusChange(data);\r\n                });\r\n\r\n                // Try to connect via SSE\r\n                ConnectionManager.init(sessionId, {\r\n                    pollInterval: pollingInterval\r\n                }).then(function () {\r\n                    // eslint-disable-next-line no-console\r\n                    console.log('SSE connection established for control panel');\r\n                    return null;\r\n                }).catch(function () {\r\n                    // eslint-disable-next-line no-console\r\n                    console.log('SSE not available, using polling fallback');\r\n                    // Ensure polling is active if SSE fails\r\n                    if (!pollingTimer) {\r\n                        self.startPolling();\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Stop polling for session statistics\r\n             *\r\n             * @private\r\n             */\r\n            stopPolling: function () {\r\n                if (pollingTimer) {\r\n                    clearInterval(pollingTimer);\r\n                    pollingTimer = null;\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Setup page unload handler to clean up polling timer\r\n             *\r\n             * @private\r\n             */\r\n            setupUnloadHandler: function () {\r\n                var self = this;\r\n                $(window).on('beforeunload', function () {\r\n                    self.stopPolling();\r\n                    self.stopStudentStatusPolling();\r\n                    ConnectionManager.disconnect();\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Setup pause/resume session controls\r\n             *\r\n             * Requirements: 1.4, 1.5\r\n             * @private\r\n             */\r\n            setupSessionControls: function () {\r\n                var self = this;\r\n\r\n                // Pause button handler\r\n                $(document).on('click', '#btn-pause-session', function (e) {\r\n                    e.preventDefault();\r\n                    self.pauseSession();\r\n                });\r\n\r\n                // Resume button handler\r\n                $(document).on('click', '#btn-resume-session', function (e) {\r\n                    e.preventDefault();\r\n                    self.resumeSession();\r\n                });\r\n            },\r\n\r\n\r\n            /**\r\n             * Pause the current session\r\n             *\r\n             * Requirement: 1.4 - Freeze timer and prevent new submissions\r\n             * @private\r\n             */\r\n            pauseSession: function () {\r\n                var self = this;\r\n\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/classengage/ajax.php',\r\n                    method: 'POST',\r\n                    data: {\r\n                        action: 'pause',\r\n                        sessionid: sessionId,\r\n                        sesskey: M.cfg.sesskey\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function (response) {\r\n                        if (response.success) {\r\n                            self.handleSessionPaused(response);\r\n                            Notification.addNotification({\r\n                                message: M.util.get_string('sessionpaused', 'mod_classengage'),\r\n                                type: 'info'\r\n                            });\r\n                        } else {\r\n                            Notification.addNotification({\r\n                                message: response.error || 'Failed to pause session',\r\n                                type: 'error'\r\n                            });\r\n                        }\r\n                    },\r\n                    error: function () {\r\n                        Notification.addNotification({\r\n                            message: 'Network error while pausing session',\r\n                            type: 'error'\r\n                        });\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Resume the paused session\r\n             *\r\n             * Requirement: 1.5 - Restore timer and re-enable submissions\r\n             * @private\r\n             */\r\n            resumeSession: function () {\r\n                var self = this;\r\n\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/classengage/ajax.php',\r\n                    method: 'POST',\r\n                    data: {\r\n                        action: 'resume',\r\n                        sessionid: sessionId,\r\n                        sesskey: M.cfg.sesskey\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function (response) {\r\n                        if (response.success) {\r\n                            self.handleSessionResumed(response);\r\n                            Notification.addNotification({\r\n                                message: M.util.get_string('sessionresumed', 'mod_classengage'),\r\n                                type: 'info'\r\n                            });\r\n                        } else {\r\n                            Notification.addNotification({\r\n                                message: response.error || 'Failed to resume session',\r\n                                type: 'error'\r\n                            });\r\n                        }\r\n                    },\r\n                    error: function () {\r\n                        Notification.addNotification({\r\n                            message: 'Network error while resuming session',\r\n                            type: 'error'\r\n                        });\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Handle session paused event\r\n             *\r\n             * @param {Object} data Pause event data\r\n             * @private\r\n             */\r\n            handleSessionPaused: function (data) {\r\n                isPaused = true;\r\n\r\n                // Update UI\r\n                $('#btn-pause-session').hide();\r\n                $('#btn-resume-session').show();\r\n                $('#session-status').text('Paused').addClass('text-warning');\r\n                $('#session-status-badge').removeClass('badge-success').addClass('badge-warning').text('Paused');\r\n\r\n                // Update timer display\r\n                if (data.timerremaining !== undefined) {\r\n                    $('#time-display').text(this.formatTime(data.timerremaining));\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Handle session resumed event\r\n             *\r\n             * @private\r\n             */\r\n            handleSessionResumed: function () {\r\n                isPaused = false;\r\n\r\n                // Update UI\r\n                $('#btn-resume-session').hide();\r\n                $('#btn-pause-session').show();\r\n                $('#session-status').text('Active').removeClass('text-warning');\r\n                $('#session-status-badge').removeClass('badge-warning').addClass('badge-success').text('Active');\r\n            },\r\n\r\n            /**\r\n             * Handle question broadcast event\r\n             *\r\n             * @param {Object} data Question broadcast data\r\n             * @private\r\n             */\r\n            handleQuestionBroadcast: function (data) {\r\n                // Reset student answered status for new question\r\n                this.resetStudentAnsweredStatus();\r\n\r\n                // Update question progress\r\n                if (data.questionnumber !== undefined) {\r\n                    var newQuestion = parseInt(data.questionnumber);\r\n                    lastQuestionNumber = newQuestion; // Update version tracker to prevent stale overwrites\r\n\r\n                    var total = $('#question-progress').data('total') || data.questionnumber + 1;\r\n                    $('#question-progress').text((newQuestion + 1) + ' / ' + total);\r\n                }\r\n\r\n                // Refresh stats\r\n                this.updateStats();\r\n            },\r\n\r\n            /**\r\n             * Handle state update from polling\r\n             *\r\n             * @param {Object} data State update data\r\n             * @private\r\n             */\r\n            handleStateUpdate: function (data) {\r\n                if (data.status) {\r\n                    isPaused = (data.status === 'paused');\r\n\r\n                    if (isPaused) {\r\n                        $('#btn-pause-session').hide();\r\n                        $('#btn-resume-session').show();\r\n                    } else {\r\n                        $('#btn-resume-session').hide();\r\n                        $('#btn-pause-session').show();\r\n                    }\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Handle connection status change\r\n             *\r\n             * @param {Object} data Status change data\r\n             * @private\r\n             */\r\n            handleConnectionStatusChange: function (data) {\r\n                var statusIndicator = $('#connection-status-indicator');\r\n                if (data.status === 'connected') {\r\n                    statusIndicator.removeClass('text-danger text-warning').addClass('text-success');\r\n                    statusIndicator.attr('title', 'Connected via ' + (data.transport || 'polling'));\r\n                } else if (data.status === 'reconnecting') {\r\n                    statusIndicator.removeClass('text-success text-danger').addClass('text-warning');\r\n                    statusIndicator.attr('title', 'Reconnecting...');\r\n                } else {\r\n                    statusIndicator.removeClass('text-success text-warning').addClass('text-danger');\r\n                    statusIndicator.attr('title', 'Disconnected');\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Start polling for student status updates\r\n             *\r\n             * Requirement: 1.3 - Display connected students count updated every 2 seconds\r\n             * @private\r\n             */\r\n            startStudentStatusPolling: function () {\r\n                var self = this;\r\n\r\n                // Poll for student status\r\n                studentStatusTimer = setInterval(function () {\r\n                    self.updateStudentStatus();\r\n                }, STUDENT_STATUS_UPDATE_INTERVAL);\r\n\r\n                // Get initial status\r\n                this.updateStudentStatus();\r\n            },\r\n\r\n            /**\r\n             * Stop student status polling\r\n             *\r\n             * @private\r\n             */\r\n            stopStudentStatusPolling: function () {\r\n                if (studentStatusTimer) {\r\n                    clearInterval(studentStatusTimer);\r\n                    studentStatusTimer = null;\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Fetch and update student connection status\r\n             *\r\n             * Requirements: 5.1, 5.4, 5.5\r\n             * @private\r\n             */\r\n            updateStudentStatus: function () {\r\n                var self = this;\r\n\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/classengage/ajax.php',\r\n                    method: 'POST',\r\n                    data: {\r\n                        action: 'getstudents',\r\n                        sessionid: sessionId,\r\n                        sesskey: M.cfg.sesskey\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function (response) {\r\n                        if (response.success) {\r\n                            self.updateStudentList(response.students || []);\r\n                            self.updateAggregateStats(response.stats || {});\r\n                        }\r\n                    },\r\n                    error: function () {\r\n                        // Silent fail - stats polling will continue\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Update the connected students list display\r\n             *\r\n             * Requirement: 5.1 - Display list of connected students with status\r\n             * @param {Array} students Array of student objects\r\n             * @private\r\n             */\r\n            updateStudentList: function (students) {\r\n                var self = this;\r\n                var container = $('#connected-students-list');\r\n                if (!container.length) {\r\n                    return;\r\n                }\r\n\r\n                // Update cache\r\n                students.forEach(function (student) {\r\n                    connectedStudents[student.userid] = student;\r\n                });\r\n\r\n                // Build student list HTML\r\n                var html = '';\r\n                if (students.length === 0) {\r\n                    html = '<div class=\"text-muted p-2\">No students connected</div>';\r\n                } else {\r\n                    html = '<ul class=\"list-group list-group-flush student-status-list\">';\r\n                    students.forEach(function (student) {\r\n                        var statusClass = self.getStatusClass(student.status);\r\n                        var statusIcon = self.getStatusIcon(student.status, student.hasanswered);\r\n                        var answeredBadge = student.hasanswered ?\r\n                            '<span class=\"badge badge-success ml-2\">Answered</span>' : '';\r\n\r\n                        html += '<li class=\"list-group-item d-flex ' +\r\n                            'justify-content-between align-items-center py-2\">';\r\n                        html += '<span class=\"student-name\">' +\r\n                            self.escapeHtml(student.fullname || 'User ' + student.userid) + '</span>';\r\n                        html += '<span class=\"student-status\">';\r\n                        html += '<i class=\"fa ' + statusIcon + ' ' + statusClass +\r\n                            '\" title=\"' + student.status + '\"></i>';\r\n                        html += answeredBadge;\r\n                        html += '</span>';\r\n                        html += '</li>';\r\n                    });\r\n                    html += '</ul>';\r\n                }\r\n\r\n                container.html(html);\r\n            },\r\n\r\n            /**\r\n             * Get CSS class for student status\r\n             *\r\n             * @param {string} status Student connection status\r\n             * @return {string} CSS class\r\n             * @private\r\n             */\r\n            getStatusClass: function (status) {\r\n                switch (status) {\r\n                    case 'connected':\r\n                        return 'text-success';\r\n                    case 'disconnected':\r\n                        return 'text-danger';\r\n                    case 'answering':\r\n                        return 'text-info';\r\n                    default:\r\n                        return 'text-muted';\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Get Font Awesome icon for student status\r\n             *\r\n             * @param {string} status Student connection status\r\n             * @param {boolean} hasAnswered Whether student has answered\r\n             * @return {string} FA icon class\r\n             * @private\r\n             */\r\n            getStatusIcon: function (status, hasAnswered) {\r\n                if (hasAnswered) {\r\n                    return 'fa-check-circle';\r\n                }\r\n                switch (status) {\r\n                    case 'connected':\r\n                        return 'fa-circle';\r\n                    case 'disconnected':\r\n                        return 'fa-times-circle';\r\n                    case 'answering':\r\n                        return 'fa-spinner fa-spin';\r\n                    default:\r\n                        return 'fa-question-circle';\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Update aggregate statistics display\r\n             *\r\n             * Requirement: 5.5 - Display aggregate statistics\r\n             * @param {Object} stats Statistics object\r\n             * @private\r\n             */\r\n            updateAggregateStats: function (stats) {\r\n                // Update connected count\r\n                if (stats.connected !== undefined) {\r\n                    $('#stat-connected').text(stats.connected);\r\n                    $('#connected-count').text(stats.connected);\r\n                }\r\n\r\n                // Update answered count\r\n                if (stats.answered !== undefined) {\r\n                    $('#stat-answered').text(stats.answered);\r\n                }\r\n\r\n                // Update pending count\r\n                if (stats.pending !== undefined) {\r\n                    $('#stat-pending').text(stats.pending);\r\n                }\r\n\r\n                // Update progress bar if available\r\n                if (stats.connected > 0 && stats.answered !== undefined) {\r\n                    var percentage = Math.round((stats.answered / stats.connected) * 100);\r\n                    $('#answered-progress').css('width', percentage + '%');\r\n                    $('#answered-progress').attr('aria-valuenow', percentage);\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Reset student answered status for new question\r\n             *\r\n             * @private\r\n             */\r\n            resetStudentAnsweredStatus: function () {\r\n                // Clear answered badges in UI\r\n                $('.student-status-list .badge-success').remove();\r\n\r\n                // Reset cache\r\n                Object.keys(connectedStudents).forEach(function (userid) {\r\n                    connectedStudents[userid].hasanswered = false;\r\n                });\r\n\r\n                // Reset aggregate stats\r\n                $('#stat-answered').text('0');\r\n                $('#stat-pending').text($('#stat-connected').text());\r\n                $('#answered-progress').css('width', '0%');\r\n            },\r\n\r\n            /**\r\n             * Escape HTML to prevent XSS\r\n             *\r\n             * @param {string} text Text to escape\r\n             * @return {string} Escaped text\r\n             * @private\r\n             */\r\n            escapeHtml: function (text) {\r\n                var div = document.createElement('div');\r\n                div.textContent = text;\r\n                return div.innerHTML;\r\n            },\r\n\r\n            /**\r\n             * Start polling for session statistics updates\r\n             */\r\n            startPolling: function () {\r\n                var self = this;\r\n\r\n                // Poll for current question stats\r\n                pollingTimer = setInterval(function () {\r\n                    self.updateStats();\r\n                }, pollingInterval);\r\n\r\n                // Get initial stats\r\n                this.updateStats();\r\n            },\r\n\r\n            /**\r\n             * Fetch and update session statistics via AJAX\r\n             *\r\n             * @private\r\n             */\r\n            updateStats: function () {\r\n                var self = this;\r\n\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/classengage/ajax.php',\r\n                    method: 'POST',\r\n                    data: {\r\n                        action: 'getstats',\r\n                        sessionid: sessionId,\r\n                        sesskey: M.cfg.sesskey\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function (response) {\r\n                        if (response.success) {\r\n                            // Reset failure counter on success\r\n                            consecutiveFailures = 0;\r\n                            warningDisplayed = false;\r\n                            self.updateDisplay(response.data);\r\n                        } else {\r\n                            // Server returned error\r\n                            self.handleError();\r\n                        }\r\n                    },\r\n                    error: function () {\r\n                        // Network or server error\r\n                        self.handleError();\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Handle AJAX errors with consecutive failure tracking\r\n             *\r\n             * @private\r\n             */\r\n            handleError: function () {\r\n                consecutiveFailures++;\r\n\r\n                // Display warning after threshold consecutive failures\r\n                if (consecutiveFailures >= MAX_CONSECUTIVE_FAILURES && !warningDisplayed) {\r\n                    Notification.addNotification({\r\n                        message: M.util.get_string('error:connectionissues', 'mod_classengage'),\r\n                        type: 'warning'\r\n                    });\r\n                    warningDisplayed = true;\r\n                }\r\n\r\n                // Continue polling - don't stop on errors\r\n            },\r\n\r\n            /**\r\n             * Update the display with new session data\r\n             *\r\n             * @param {Object} data Session statistics data\r\n             * @private\r\n             */\r\n            updateDisplay: function (data) {\r\n                // Update participant count\r\n                if (data.participants !== undefined) {\r\n                    $('#participant-count').text(data.participants);\r\n                }\r\n\r\n                // Update question progress\r\n                if (data.currentquestion !== undefined && data.totalquestions !== undefined) {\r\n                    var newQuestion = parseInt(data.currentquestion);\r\n\r\n                    // Prevent flickering: only update if question number is same or newer\r\n                    if (newQuestion >= lastQuestionNumber) {\r\n                        lastQuestionNumber = newQuestion;\r\n                        $('#question-progress').text((newQuestion + 1) + ' / ' + data.totalquestions);\r\n                        $('#question-progress').data('total', data.totalquestions);\r\n                    }\r\n                }\r\n\r\n                // Update response count and participation rate\r\n                if (data.responses !== undefined) {\r\n                    $('#response-count').text(data.responses + ' / ' + data.participants);\r\n\r\n                    if (data.participationrate !== undefined) {\r\n                        $('#response-rate').text(data.participationrate + '%');\r\n                        $('#response-progress').css('width', data.participationrate + '%');\r\n                        $('#response-progress').attr('aria-valuenow', data.participationrate);\r\n                    }\r\n                }\r\n\r\n                // Update connection statistics (Requirement 5.5)\r\n                if (data.connected !== undefined) {\r\n                    this.updateAggregateStats({\r\n                        connected: data.connected,\r\n                        answered: data.answered,\r\n                        pending: data.pending\r\n                    });\r\n                }\r\n\r\n                // Update answer distribution\r\n                if (data.distribution) {\r\n                    this.updateDistribution(data.distribution);\r\n\r\n                    if (chart) {\r\n                        this.updateChart(data.distribution);\r\n                    }\r\n                }\r\n\r\n                // Update session status\r\n                if (data.status) {\r\n                    isPaused = (data.status === 'paused');\r\n\r\n                    var statusText = data.status.charAt(0).toUpperCase() + data.status.slice(1);\r\n                    $('#session-status').text(statusText);\r\n\r\n                    // Update pause/resume buttons\r\n                    if (isPaused) {\r\n                        $('#btn-pause-session').hide();\r\n                        $('#btn-resume-session').show();\r\n                        $('#session-status-badge').removeClass('badge-success').addClass('badge-warning');\r\n                    } else if (data.status === 'active') {\r\n                        $('#btn-resume-session').hide();\r\n                        $('#btn-pause-session').show();\r\n                        $('#session-status-badge').removeClass('badge-warning').addClass('badge-success');\r\n                    }\r\n\r\n                    // Stop polling if session is completed\r\n                    if (data.status === 'completed') {\r\n                        this.stopPolling();\r\n                        this.stopStudentStatusPolling();\r\n                    }\r\n                }\r\n\r\n                // Update time display\r\n                this.updateTimeDisplay(data);\r\n            },\r\n\r\n            /**\r\n             * Update the time display\r\n             *\r\n             * @param {Object} data Session data\r\n             * @private\r\n             */\r\n            updateTimeDisplay: function (data) {\r\n                var timeText = '--:--';\r\n\r\n                if (isPaused && data.timerremaining !== undefined) {\r\n                    // Show frozen time when paused\r\n                    timeText = this.formatTime(data.timerremaining);\r\n                    $('#time-display').addClass('text-warning');\r\n                } else if (data.timelimit > 0) {\r\n                    // Show remaining time\r\n                    var remaining = data.timeremaining !== undefined ? data.timeremaining : 0;\r\n                    timeText = this.formatTime(remaining);\r\n\r\n                    // Add warning class if low time\r\n                    var timeDisplay = $('#time-display');\r\n                    if (remaining < 10) {\r\n                        timeDisplay.addClass('text-danger').addClass('font-weight-bold');\r\n                    } else {\r\n                        timeDisplay.removeClass('text-danger').removeClass('font-weight-bold').removeClass('text-warning');\r\n                    }\r\n                } else {\r\n                    // Show elapsed time\r\n                    var elapsed = data.elapsed !== undefined ? data.elapsed : 0;\r\n                    timeText = this.formatTime(elapsed);\r\n                }\r\n\r\n                $('#time-display').text(timeText);\r\n            },\r\n\r\n            /**\r\n             * Format seconds into MM:SS\r\n             *\r\n             * @param {number} seconds Seconds to format\r\n             * @return {string} Formatted time string\r\n             * @private\r\n             */\r\n            formatTime: function (seconds) {\r\n                var m = Math.floor(seconds / 60);\r\n                var s = Math.floor(seconds % 60);\r\n                return (m < 10 ? '0' + m : m) + ':' + (s < 10 ? '0' + s : s);\r\n            },\r\n\r\n            /**\r\n             * Update the answer distribution table\r\n             *\r\n             * @param {Object} distribution Distribution data with A, B, C, D counts\r\n             * @private\r\n             */\r\n            updateDistribution: function (distribution) {\r\n                var total = distribution.total || 0;\r\n                var correctAnswer = distribution.correctanswer || '';\r\n\r\n                ANSWER_OPTIONS.forEach(function (option) {\r\n                    var count = distribution[option] || 0;\r\n                    var percentage = total > 0 ? Math.round((count / total) * 100) : 0;\r\n                    var isCorrect = option === correctAnswer.toUpperCase();\r\n\r\n                    // Update count\r\n                    var countElem = $('#count-' + option);\r\n                    if (countElem.length) {\r\n                        countElem.text(count);\r\n                    }\r\n\r\n                    // Update percentage\r\n                    var percentElem = $('#percent-' + option);\r\n                    if (percentElem.length) {\r\n                        percentElem.text(percentage + '%');\r\n                    }\r\n\r\n                    // Update progress bar\r\n                    var progressBar = $('#bar-' + option);\r\n                    if (progressBar.length) {\r\n                        progressBar.css('width', percentage + '%');\r\n                        progressBar.attr('aria-valuenow', percentage);\r\n                    }\r\n\r\n                    // Highlight correct answer\r\n                    var row = $('#row-' + option);\r\n                    if (row.length) {\r\n                        if (isCorrect) {\r\n                            row.addClass('table-success');\r\n                            progressBar.removeClass('bg-info').addClass('bg-success');\r\n                        } else {\r\n                            row.removeClass('table-success');\r\n                            progressBar.removeClass('bg-success').addClass('bg-info');\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Initialize Chart.js bar chart for response visualization\r\n             *\r\n             * @private\r\n             */\r\n            initChart: function () {\r\n                var ctx = document.getElementById('responseChart');\r\n                if (!ctx) {\r\n                    return;\r\n                }\r\n\r\n                // Check if Chart.js loaded successfully\r\n                if (typeof window.Chart === 'undefined') {\r\n                    // eslint-disable-next-line no-console\r\n                    console.error('Chart.js failed to load. Displaying table view only.');\r\n                    return;\r\n                }\r\n\r\n                chart = new window.Chart(ctx, {\r\n                    type: 'bar',\r\n                    data: {\r\n                        labels: ANSWER_OPTIONS,\r\n                        datasets: [{\r\n                            label: 'Responses',\r\n                            data: [0, 0, 0, 0],\r\n                            backgroundColor: [\r\n                                'rgba(54, 162, 235, 0.8)',\r\n                                'rgba(54, 162, 235, 0.8)',\r\n                                'rgba(54, 162, 235, 0.8)',\r\n                                'rgba(54, 162, 235, 0.8)'\r\n                            ],\r\n                            borderColor: [\r\n                                'rgba(54, 162, 235, 1)',\r\n                                'rgba(54, 162, 235, 1)',\r\n                                'rgba(54, 162, 235, 1)',\r\n                                'rgba(54, 162, 235, 1)'\r\n                            ],\r\n                            borderWidth: 1\r\n                        }]\r\n                    },\r\n                    options: {\r\n                        responsive: true,\r\n                        maintainAspectRatio: false,\r\n                        scales: {\r\n                            y: {\r\n                                beginAtZero: true,\r\n                                ticks: {\r\n                                    stepSize: 1\r\n                                }\r\n                            }\r\n                        },\r\n                        plugins: {\r\n                            legend: {\r\n                                display: false\r\n                            },\r\n                            title: {\r\n                                display: true,\r\n                                text: 'Response Distribution'\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             * Update chart with new distribution data\r\n             *\r\n             * @param {Object} distribution Distribution data with A, B, C, D counts\r\n             * @private\r\n             */\r\n            updateChart: function (distribution) {\r\n                if (!chart) {\r\n                    return;\r\n                }\r\n\r\n                var data = ANSWER_OPTIONS.map(function (option) {\r\n                    return distribution[option] || 0;\r\n                });\r\n\r\n                var correctAnswer = distribution.correctanswer || '';\r\n                var colors = ANSWER_OPTIONS.map(function (option) {\r\n                    return option === correctAnswer.toUpperCase() ?\r\n                        'rgba(75, 192, 192, 0.8)' : 'rgba(54, 162, 235, 0.8)';\r\n                });\r\n\r\n                var borderColors = ANSWER_OPTIONS.map(function (option) {\r\n                    return option === correctAnswer.toUpperCase() ?\r\n                        'rgba(75, 192, 192, 1)' : 'rgba(54, 162, 235, 1)';\r\n                });\r\n\r\n                chart.data.datasets[0].data = data;\r\n                chart.data.datasets[0].backgroundColor = colors;\r\n                chart.data.datasets[0].borderColor = borderColors;\r\n                chart.update('none');\r\n            },\r\n\r\n        };\r\n    });\r\n"],"names":["define","$","Notification","ConnectionManager","pollingTimer","pollingInterval","sessionId","chart","consecutiveFailures","warningDisplayed","lastQuestionNumber","ANSWER_OPTIONS","isPaused","studentStatusTimer","connectedStudents","init","sid","interval","console","log","initSSEConnection","startPolling","startStudentStatusPolling","initChart","setupSessionControls","setupUnloadHandler","self","this","on","data","handleSessionPaused","handleSessionResumed","handleQuestionBroadcast","handleStateUpdate","handleConnectionStatusChange","pollInterval","then","catch","stopPolling","clearInterval","window","stopStudentStatusPolling","disconnect","document","e","preventDefault","pauseSession","resumeSession","ajax","url","M","cfg","wwwroot","method","action","sessionid","sesskey","dataType","success","response","addNotification","message","util","get_string","type","error","hide","show","text","addClass","removeClass","undefined","timerremaining","formatTime","resetStudentAnsweredStatus","questionnumber","newQuestion","parseInt","total","updateStats","status","statusIndicator","attr","transport","setInterval","updateStudentStatus","updateStudentList","students","updateAggregateStats","stats","container","length","forEach","student","userid","html","statusClass","getStatusClass","statusIcon","getStatusIcon","hasanswered","answeredBadge","escapeHtml","fullname","hasAnswered","connected","answered","pending","percentage","Math","round","css","remove","Object","keys","div","createElement","textContent","innerHTML","updateDisplay","handleError","participants","currentquestion","totalquestions","responses","participationrate","distribution","updateDistribution","updateChart","statusText","charAt","toUpperCase","slice","updateTimeDisplay","timeText","timelimit","remaining","timeremaining","timeDisplay","elapsed","seconds","m","floor","s","correctAnswer","correctanswer","option","count","isCorrect","countElem","percentElem","progressBar","row","ctx","getElementById","Chart","labels","datasets","label","backgroundColor","borderColor","borderWidth","options","responsive","maintainAspectRatio","scales","y","beginAtZero","ticks","stepSize","plugins","legend","display","title","map","colors","borderColors","update"],"mappings":"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"}