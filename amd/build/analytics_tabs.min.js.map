{"version":3,"file":"analytics_tabs.min.js","sources":["../src/analytics_tabs.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for analytics tab switching and state management\n *\n * This module handles:\n * - Tab click handlers for Simple and Advanced analysis tabs\n * - Smooth transition animations between tabs\n * - URL hash updates for bookmarkable tabs\n * - Lazy loading for Advanced tab data via AJAX\n * - Tab preference storage in local storage\n * - Keyboard accessibility for tab controls\n *\n * @module     mod_classengage/analytics_tabs\n * @package\n * @copyright  2025 Danielle\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'],\n    function($, Ajax, Notification) {\n\n    // Constants\n    const TAB_SIMPLE = 'simple';\n    const TAB_ADVANCED = 'advanced';\n    const STORAGE_KEY = 'mod_classengage_analytics_tab';\n    const TRANSITION_DURATION = 300; // Milliseconds\n    const FADE_OUT_OPACITY = 0;\n    const FADE_IN_OPACITY = 1;\n\n    // Module state\n    let currentTab = TAB_SIMPLE;\n    let advancedDataLoaded = false;\n    let sessionId = null;\n    let cmId = null;\n\n    /**\n     * Initialize the tab switching functionality\n     *\n     * @param {number} sid Session ID\n     * @param {number} cid Course module ID\n     */\n    const init = function(sid, cid) {\n        sessionId = sid;\n        cmId = cid;\n\n        // Restore tab preference from local storage or URL hash\n        restoreTabState();\n\n        // Set up tab click handlers\n        setupTabHandlers();\n\n        // Set up keyboard accessibility\n        setupKeyboardNavigation();\n\n        // Handle browser back/forward buttons\n        setupHashChangeHandler();\n\n        // Show initial tab\n        showTab(currentTab, false);\n    };\n\n    /**\n     * Restore tab state from local storage or URL hash\n     *\n     * @private\n     */\n    const restoreTabState = function() {\n        // Check URL hash first (takes precedence)\n        const hash = window.location.hash.substring(1);\n        if (hash === TAB_SIMPLE || hash === TAB_ADVANCED) {\n            currentTab = hash;\n            return;\n        }\n\n        // Fall back to local storage\n        try {\n            const stored = localStorage.getItem(STORAGE_KEY);\n            if (stored === TAB_SIMPLE || stored === TAB_ADVANCED) {\n                currentTab = stored;\n            }\n        } catch (e) {\n            // Local storage not available or disabled - use default\n            // eslint-disable-next-line no-console\n            console.warn('Local storage not available:', e);\n        }\n    };\n\n    /**\n     * Set up click handlers for tab navigation\n     *\n     * @private\n     */\n    const setupTabHandlers = function() {\n        // Simple tab click handler\n        $('#tab-simple').on('click', function(e) {\n            e.preventDefault();\n            switchTab(TAB_SIMPLE);\n        });\n\n        // Advanced tab click handler\n        $('#tab-advanced').on('click', function(e) {\n            e.preventDefault();\n            switchTab(TAB_ADVANCED);\n        });\n    };\n\n    /**\n     * Set up keyboard navigation for tabs\n     *\n     * @private\n     */\n    const setupKeyboardNavigation = function() {\n        const tabs = $('#tab-simple, #tab-advanced');\n\n        tabs.on('keydown', function(e) {\n            const $this = $(this);\n            let $target = null;\n\n            // Arrow key navigation\n            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {\n                e.preventDefault();\n\n                if (e.key === 'ArrowRight') {\n                    $target = $this.next('[role=\"tab\"]');\n                    if ($target.length === 0) {\n                        $target = tabs.first();\n                    }\n                } else {\n                    $target = $this.prev('[role=\"tab\"]');\n                    if ($target.length === 0) {\n                        $target = tabs.last();\n                    }\n                }\n\n                $target.focus().trigger('click');\n            }\n\n            // Enter or Space to activate\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                $this.trigger('click');\n            }\n        });\n    };\n\n    /**\n     * Set up handler for browser back/forward buttons\n     *\n     * @private\n     */\n    const setupHashChangeHandler = function() {\n        $(window).on('hashchange', function() {\n            const hash = window.location.hash.substring(1);\n            if (hash === TAB_SIMPLE || hash === TAB_ADVANCED) {\n                showTab(hash, false);\n            }\n        });\n    };\n\n    /**\n     * Switch to a different tab\n     *\n     * @param {string} tab Tab identifier (simple or advanced)\n     * @private\n     */\n    const switchTab = function(tab) {\n        if (tab === currentTab) {\n            return; // Already on this tab\n        }\n\n        currentTab = tab;\n\n        // Update URL hash\n        updateUrlHash(tab);\n\n        // Store preference\n        storeTabPreference(tab);\n\n        // Show the tab with animation\n        showTab(tab, true);\n\n        // Lazy load advanced data if needed\n        if (tab === TAB_ADVANCED && !advancedDataLoaded) {\n            loadAdvancedData();\n        }\n    };\n\n    /**\n     * Update URL hash for bookmarkable tabs\n     *\n     * @param {string} tab Tab identifier\n     * @private\n     */\n    const updateUrlHash = function(tab) {\n        // Update hash without triggering scroll or hashchange event\n        if (history.pushState) {\n            history.pushState(null, null, '#' + tab);\n        } else {\n            window.location.hash = tab;\n        }\n    };\n\n    /**\n     * Store tab preference in local storage\n     *\n     * @param {string} tab Tab identifier\n     * @private\n     */\n    const storeTabPreference = function(tab) {\n        try {\n            localStorage.setItem(STORAGE_KEY, tab);\n        } catch (e) {\n            // Local storage not available - silently fail\n            // eslint-disable-next-line no-console\n            console.warn('Could not store tab preference:', e);\n        }\n    };\n\n    /**\n     * Show the specified tab with optional animation\n     *\n     * @param {string} tab Tab identifier\n     * @param {boolean} animate Whether to animate the transition\n     * @private\n     */\n    const showTab = function(tab, animate) {\n        const $simpleTab = $('#tab-simple');\n        const $advancedTab = $('#tab-advanced');\n        const $simplePanel = $('#panel-simple');\n        const $advancedPanel = $('#panel-advanced');\n\n        // Update ARIA attributes and active states\n        if (tab === TAB_SIMPLE) {\n            $simpleTab.attr('aria-selected', 'true').addClass('active');\n            $advancedTab.attr('aria-selected', 'false').removeClass('active');\n            $simplePanel.attr('aria-hidden', 'false');\n            $advancedPanel.attr('aria-hidden', 'true');\n        } else {\n            $simpleTab.attr('aria-selected', 'false').removeClass('active');\n            $advancedTab.attr('aria-selected', 'true').addClass('active');\n            $simplePanel.attr('aria-hidden', 'true');\n            $advancedPanel.attr('aria-hidden', 'false');\n        }\n\n        if (animate) {\n            // Fade out current panel\n            const $currentPanel = tab === TAB_SIMPLE ? $advancedPanel : $simplePanel;\n            const $targetPanel = tab === TAB_SIMPLE ? $simplePanel : $advancedPanel;\n\n            $currentPanel.fadeTo(TRANSITION_DURATION, FADE_OUT_OPACITY, function() {\n                $currentPanel.hide();\n                $targetPanel.hide().fadeTo(TRANSITION_DURATION, FADE_IN_OPACITY, function() {\n                    $targetPanel.css('opacity', ''); // Remove inline opacity\n                });\n            });\n        } else {\n            // No animation - just show/hide\n            if (tab === TAB_SIMPLE) {\n                $simplePanel.show();\n                $advancedPanel.hide();\n            } else {\n                $simplePanel.hide();\n                $advancedPanel.show();\n            }\n        }\n    };\n\n    /**\n     * Lazy load Advanced tab data via AJAX\n     *\n     * @private\n     */\n    const loadAdvancedData = function() {\n        // Show loading indicator\n        const $advancedPanel = $('#panel-advanced');\n        const $loadingIndicator = $('<div class=\"text-center p-5\">' +\n            '<div class=\"spinner-border text-primary\" role=\"status\">' +\n            '<span class=\"sr-only\">Loading...</span>' +\n            '</div>' +\n            '</div>');\n\n        $advancedPanel.prepend($loadingIndicator);\n\n        // Make AJAX request to load advanced data\n        const promises = Ajax.call([{\n            methodname: 'mod_classengage_get_advanced_analytics',\n            args: {\n                sessionid: sessionId,\n                cmid: cmId\n            }\n        }]);\n\n        promises[0].done(function(response) {\n            advancedDataLoaded = true;\n            $loadingIndicator.remove();\n\n            // Populate advanced tab with data\n            populateAdvancedTab(response);\n\n        }).fail(function(error) {\n            $loadingIndicator.remove();\n\n            // Show error message\n            Notification.addNotification({\n                message: error.message || 'Failed to load advanced analytics data',\n                type: 'error'\n            });\n\n            // eslint-disable-next-line no-console\n            console.error('Failed to load advanced analytics:', error);\n        });\n    };\n\n    /**\n     * Populate Advanced tab with loaded data\n     *\n     * @param {Object} data Advanced analytics data\n     * @private\n     */\n    const populateAdvancedTab = function(data) {\n        // This function would populate the advanced tab with the loaded data\n        // For now, we'll assume the data is already rendered server-side\n        // And this is just a placeholder for future lazy loading implementation\n\n        // If data needs to be rendered client-side, it would be done here\n        // For example:\n        // - Render concept difficulty table\n        // - Initialize engagement timeline chart\n        // - Render response trends\n        // - Display teaching recommendations\n        // - Initialize participation distribution chart\n\n        // eslint-disable-next-line no-console\n        console.log('Advanced analytics data loaded:', data);\n    };\n\n    // Public API\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Ajax","Notification","currentTab","advancedDataLoaded","sessionId","cmId","restoreTabState","hash","window","location","substring","stored","localStorage","getItem","e","console","warn","setupTabHandlers","on","preventDefault","switchTab","setupKeyboardNavigation","tabs","$this","this","$target","key","next","length","first","prev","last","focus","trigger","setupHashChangeHandler","showTab","tab","updateUrlHash","storeTabPreference","loadAdvancedData","history","pushState","setItem","animate","$simpleTab","$advancedTab","$simplePanel","$advancedPanel","attr","addClass","removeClass","$currentPanel","$targetPanel","fadeTo","hide","css","show","$loadingIndicator","prepend","call","methodname","args","sessionid","cmid","done","response","remove","populateAdvancedTab","fail","error","addNotification","message","type","data","log","init","sid","cid"],"mappings":"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"}