{"version":3,"file":"analytics_filters.min.js","sources":["../src/analytics_filters.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Filter interactions for analytics page\n *\n * @module     mod_classengage/analytics_filters\n * @copyright  2025 Danielle\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    var cmid = 0;\n    var sessionid = 0;\n    var debounceTimer = null;\n    var currentSort = {\n        column: '',\n        direction: 'ASC'\n    };\n\n    /**\n     * Initialize filter interactions\n     *\n     * @param {number} courseModuleId - Course module ID\n     * @param {number} selectedSessionId - Selected session ID\n     */\n    var init = function(courseModuleId, selectedSessionId) {\n        cmid = courseModuleId;\n        sessionid = selectedSessionId;\n\n        attachFilterHandlers();\n        attachSortHandlers();\n        attachPaginationHandlers();\n    };\n\n    /**\n     * Attach event handlers to filter controls\n     */\n    var attachFilterHandlers = function() {\n        // Name search with debouncing\n        var nameSearch = document.getElementById('filter-namesearch');\n        if (nameSearch) {\n            nameSearch.addEventListener('input', function() {\n                clearTimeout(debounceTimer);\n                debounceTimer = setTimeout(function() {\n                    applyFilters();\n                }, 300);\n            });\n        }\n\n        // Score range inputs\n        var minScore = document.getElementById('filter-minscore');\n        if (minScore) {\n            minScore.addEventListener('change', function() {\n                applyFilters();\n            });\n        }\n\n        var maxScore = document.getElementById('filter-maxscore');\n        if (maxScore) {\n            maxScore.addEventListener('change', function() {\n                applyFilters();\n            });\n        }\n\n        // Response time range inputs\n        var minTime = document.getElementById('filter-mintime');\n        if (minTime) {\n            minTime.addEventListener('change', function() {\n                applyFilters();\n            });\n        }\n\n        var maxTime = document.getElementById('filter-maxtime');\n        if (maxTime) {\n            maxTime.addEventListener('change', function() {\n                applyFilters();\n            });\n        }\n\n        // Top performers checkbox\n        var topOnly = document.getElementById('filter-toponly');\n        if (topOnly) {\n            topOnly.addEventListener('change', function() {\n                applyFilters();\n            });\n        }\n\n        // Question filter dropdown\n        var questionFilter = document.getElementById('filter-questionid');\n        if (questionFilter) {\n            questionFilter.addEventListener('change', function() {\n                applyFilters();\n\n            });\n        }\n\n        // Per page selector\n        var perPage = document.getElementById('filter-perpage');\n        if (perPage) {\n            perPage.addEventListener('change', function() {\n                applyFilters();\n            });\n        }\n\n        // Clear filters button\n        var clearBtn = document.getElementById('clear-filters-btn');\n        if (clearBtn) {\n            clearBtn.addEventListener('click', function(e) {\n                e.preventDefault();\n                clearFilters();\n            });\n        }\n    };\n\n    /**\n     * Attach event handlers to sortable column headers\n     */\n    var attachSortHandlers = function() {\n        var sortableHeaders = document.querySelectorAll('[data-sortable]');\n\n        sortableHeaders.forEach(function(header) {\n            header.style.cursor = 'pointer';\n            header.addEventListener('click', function() {\n                var column = this.getAttribute('data-sortable');\n\n                // Toggle direction if same column, otherwise default to ASC\n                if (currentSort.column === column) {\n                    currentSort.direction = currentSort.direction === 'ASC' ? 'DESC' : 'ASC';\n                } else {\n                    currentSort.column = column;\n                    currentSort.direction = 'ASC';\n                }\n\n                applyFilters();\n            });\n        });\n    };\n\n    /**\n     * Attach event handlers to pagination controls\n     */\n    var attachPaginationHandlers = function() {\n        var paginationLinks = document.querySelectorAll('[data-page]');\n\n        paginationLinks.forEach(function(link) {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                var page = parseInt(this.getAttribute('data-page'), 10);\n                if (page > 0) {\n                    navigateToPage(page);\n                }\n            });\n        });\n    };\n\n    /**\n     * Apply current filters and reload page\n     */\n    var applyFilters = function() {\n        var params = buildUrlParams();\n        var url = buildUrl(params);\n        window.location.href = url;\n    };\n\n    /**\n     * Clear all filters and reload page\n     */\n    var clearFilters = function() {\n        var url = buildUrl({\n            id: cmid,\n            sessionid: sessionid\n        });\n        window.location.href = url;\n    };\n\n    /**\n     * Navigate to specific page\n     *\n     * @param {number} page - Page number (1-based)\n     */\n    var navigateToPage = function(page) {\n        var params = buildUrlParams();\n        params.page = page;\n        var url = buildUrl(params);\n        window.location.href = url;\n    };\n\n    /**\n     * Build URL parameters object from current filter values\n     *\n     * @return {Object} URL parameters\n     */\n    var buildUrlParams = function() {\n        var params = {\n            id: cmid,\n            sessionid: sessionid\n        };\n\n        // Name search\n        var nameSearch = document.getElementById('filter-namesearch');\n        if (nameSearch && nameSearch.value.trim() !== '') {\n            params.namesearch = nameSearch.value.trim();\n        }\n\n        // Score range\n        var minScore = document.getElementById('filter-minscore');\n        if (minScore && minScore.value !== '') {\n            params.minscore = minScore.value;\n        }\n\n        var maxScore = document.getElementById('filter-maxscore');\n        if (maxScore && maxScore.value !== '') {\n            params.maxscore = maxScore.value;\n        }\n\n        // Response time range\n        var minTime = document.getElementById('filter-mintime');\n        if (minTime && minTime.value !== '') {\n            params.mintime = minTime.value;\n        }\n\n        var maxTime = document.getElementById('filter-maxtime');\n        if (maxTime && maxTime.value !== '') {\n            params.maxtime = maxTime.value;\n        }\n\n        // Top performers only\n        var topOnly = document.getElementById('filter-toponly');\n        if (topOnly && topOnly.checked) {\n            params.toponly = 1;\n        }\n\n        // Question filter\n        var questionFilter = document.getElementById('filter-questionid');\n        if (questionFilter && questionFilter.value !== '' && questionFilter.value !== '0') {\n            params.questionid = questionFilter.value;\n        }\n\n        // Sorting\n        if (currentSort.column !== '') {\n            params.sort = currentSort.column;\n            params.dir = currentSort.direction;\n        }\n\n        // Pagination\n        var perPage = document.getElementById('filter-perpage');\n        if (perPage && perPage.value !== '') {\n            params.perpage = perPage.value;\n        }\n\n        // Current page (preserve if not explicitly changed)\n        var currentPage = getCurrentPage();\n        if (currentPage > 1) {\n            params.page = currentPage;\n        }\n\n        return params;\n    };\n\n    /**\n     * Get current page number from URL or default to 1\n     *\n     * @return {number} Current page number\n     */\n    var getCurrentPage = function() {\n        var urlParams = new URLSearchParams(window.location.search);\n        var page = parseInt(urlParams.get('page'), 10);\n        return isNaN(page) || page < 1 ? 1 : page;\n    };\n\n    /**\n     * Build URL from parameters object\n     *\n     * @param {Object} params - URL parameters\n     * @return {string} Complete URL\n     */\n    var buildUrl = function(params) {\n        var baseUrl = window.location.pathname;\n        var queryString = Object.keys(params).map(function(key) {\n            return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\n        }).join('&');\n\n        return baseUrl + '?' + queryString;\n    };\n\n    /**\n     * Initialize sort indicators from URL parameters\n     */\n    var initializeSortState = function() {\n        var urlParams = new URLSearchParams(window.location.search);\n        var sortColumn = urlParams.get('sort');\n        var sortDirection = urlParams.get('dir');\n\n        if (sortColumn) {\n            currentSort.column = sortColumn;\n            currentSort.direction = sortDirection === 'DESC' ? 'DESC' : 'ASC';\n\n            // Update visual indicators\n            updateSortIndicators();\n        }\n    };\n\n    /**\n     * Update visual sort indicators on column headers\n     */\n    var updateSortIndicators = function() {\n        var sortableHeaders = document.querySelectorAll('[data-sortable]');\n\n        sortableHeaders.forEach(function(header) {\n            var column = header.getAttribute('data-sortable');\n\n            // Remove existing indicators\n            var existingIndicator = header.querySelector('.sort-indicator');\n            if (existingIndicator) {\n                existingIndicator.remove();\n            }\n\n            // Add indicator if this is the sorted column\n            if (column === currentSort.column) {\n                var indicator = document.createElement('span');\n                indicator.className = 'sort-indicator';\n                indicator.innerHTML = currentSort.direction === 'ASC' ? ' ▲' : ' ▼';\n                header.appendChild(indicator);\n            }\n        });\n    };\n\n    // Initialize sort state when module loads\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initializeSortState);\n    } else {\n        initializeSortState();\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","cmid","sessionid","debounceTimer","currentSort","column","direction","attachFilterHandlers","nameSearch","document","getElementById","addEventListener","clearTimeout","setTimeout","applyFilters","minScore","maxScore","minTime","maxTime","topOnly","questionFilter","perPage","clearBtn","e","preventDefault","clearFilters","attachSortHandlers","querySelectorAll","forEach","header","style","cursor","this","getAttribute","attachPaginationHandlers","link","page","parseInt","navigateToPage","params","buildUrlParams","url","buildUrl","window","location","href","id","value","trim","namesearch","minscore","maxscore","mintime","maxtime","checked","toponly","questionid","sort","dir","perpage","currentPage","getCurrentPage","urlParams","URLSearchParams","search","get","isNaN","pathname","Object","keys","map","key","encodeURIComponent","join","initializeSortState","sortColumn","sortDirection","updateSortIndicators","existingIndicator","querySelector","remove","indicator","createElement","className","innerHTML","appendChild","readyState","init","courseModuleId","selectedSessionId"],"mappings":"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"}