/**
 * JavaScript for analytics tab switching and state management
 *
 * This module handles:
 * - Tab click handlers for Simple and Advanced analysis tabs
 * - Smooth transition animations between tabs
 * - URL hash updates for bookmarkable tabs
 * - Lazy loading for Advanced tab data via AJAX
 * - Tab preference storage in local storage
 * - Keyboard accessibility for tab controls
 *
 * @module     mod_classengage/analytics_tabs
 * @package
 * @copyright  2025 Danielle
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_classengage/analytics_tabs",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){let currentTab="simple",advancedDataLoaded=!1,sessionId=null,cmId=null;const restoreTabState=function(){const hash=window.location.hash.substring(1);if("simple"!==hash&&"advanced"!==hash)try{const stored=localStorage.getItem("mod_classengage_analytics_tab");"simple"!==stored&&"advanced"!==stored||(currentTab=stored)}catch(e){console.warn("Local storage not available:",e)}else currentTab=hash},setupTabHandlers=function(){$("#tab-simple").on("click",(function(e){e.preventDefault(),switchTab("simple")})),$("#tab-advanced").on("click",(function(e){e.preventDefault(),switchTab("advanced")}))},setupKeyboardNavigation=function(){const tabs=$("#tab-simple, #tab-advanced");tabs.on("keydown",(function(e){const $this=$(this);let $target=null;"ArrowRight"!==e.key&&"ArrowLeft"!==e.key||(e.preventDefault(),"ArrowRight"===e.key?($target=$this.next('[role="tab"]'),0===$target.length&&($target=tabs.first())):($target=$this.prev('[role="tab"]'),0===$target.length&&($target=tabs.last())),$target.focus().trigger("click")),"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$this.trigger("click"))}))},setupHashChangeHandler=function(){$(window).on("hashchange",(function(){const hash=window.location.hash.substring(1);"simple"!==hash&&"advanced"!==hash||showTab(hash,!1)}))},switchTab=function(tab){tab!==currentTab&&(currentTab=tab,updateUrlHash(tab),storeTabPreference(tab),showTab(tab,!0),"advanced"!==tab||advancedDataLoaded||loadAdvancedData())},updateUrlHash=function(tab){history.pushState?history.pushState(null,null,"#"+tab):window.location.hash=tab},storeTabPreference=function(tab){try{localStorage.setItem("mod_classengage_analytics_tab",tab)}catch(e){console.warn("Could not store tab preference:",e)}},showTab=function(tab,animate){const $simpleTab=$("#tab-simple"),$advancedTab=$("#tab-advanced"),$simplePanel=$("#panel-simple"),$advancedPanel=$("#panel-advanced");if("simple"===tab?($simpleTab.attr("aria-selected","true").addClass("active"),$advancedTab.attr("aria-selected","false").removeClass("active"),$simplePanel.attr("aria-hidden","false"),$advancedPanel.attr("aria-hidden","true")):($simpleTab.attr("aria-selected","false").removeClass("active"),$advancedTab.attr("aria-selected","true").addClass("active"),$simplePanel.attr("aria-hidden","true"),$advancedPanel.attr("aria-hidden","false")),animate){const $currentPanel="simple"===tab?$advancedPanel:$simplePanel,$targetPanel="simple"===tab?$simplePanel:$advancedPanel;$currentPanel.fadeTo(300,0,(function(){$currentPanel.hide(),$targetPanel.hide().fadeTo(300,1,(function(){$targetPanel.css("opacity","")}))}))}else"simple"===tab?($simplePanel.show(),$advancedPanel.hide()):($simplePanel.hide(),$advancedPanel.show())},loadAdvancedData=function(){const $advancedPanel=$("#panel-advanced"),$loadingIndicator=$('<div class="text-center p-5"><div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div></div>');$advancedPanel.prepend($loadingIndicator);Ajax.call([{methodname:"mod_classengage_get_advanced_analytics",args:{sessionid:sessionId,cmid:cmId}}])[0].done((function(response){advancedDataLoaded=!0,$loadingIndicator.remove(),populateAdvancedTab(response)})).fail((function(error){$loadingIndicator.remove(),Notification.addNotification({message:error.message||"Failed to load advanced analytics data",type:"error"}),console.error("Failed to load advanced analytics:",error)}))},populateAdvancedTab=function(data){console.log("Advanced analytics data loaded:",data)};return{init:function(sid,cid){sessionId=sid,cmId=cid,restoreTabState(),setupTabHandlers(),setupKeyboardNavigation(),setupHashChangeHandler(),showTab(currentTab,!1)}}}));

//# sourceMappingURL=analytics_tabs.min.js.map