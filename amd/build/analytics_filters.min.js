/**
 * Filter interactions for analytics page
 *
 * @module     mod_classengage/analytics_filters
 * @copyright  2025 Danielle
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_classengage/analytics_filters",[],(function(){var cmid=0,sessionid=0,debounceTimer=null,currentSort={column:"",direction:"ASC"},attachFilterHandlers=function(){var nameSearch=document.getElementById("filter-namesearch");nameSearch&&nameSearch.addEventListener("input",(function(){clearTimeout(debounceTimer),debounceTimer=setTimeout((function(){applyFilters()}),300)}));var minScore=document.getElementById("filter-minscore");minScore&&minScore.addEventListener("change",(function(){applyFilters()}));var maxScore=document.getElementById("filter-maxscore");maxScore&&maxScore.addEventListener("change",(function(){applyFilters()}));var minTime=document.getElementById("filter-mintime");minTime&&minTime.addEventListener("change",(function(){applyFilters()}));var maxTime=document.getElementById("filter-maxtime");maxTime&&maxTime.addEventListener("change",(function(){applyFilters()}));var topOnly=document.getElementById("filter-toponly");topOnly&&topOnly.addEventListener("change",(function(){applyFilters()}));var questionFilter=document.getElementById("filter-questionid");questionFilter&&questionFilter.addEventListener("change",(function(){applyFilters()}));var perPage=document.getElementById("filter-perpage");perPage&&perPage.addEventListener("change",(function(){applyFilters()}));var clearBtn=document.getElementById("clear-filters-btn");clearBtn&&clearBtn.addEventListener("click",(function(e){e.preventDefault(),clearFilters()}))},attachSortHandlers=function(){document.querySelectorAll("[data-sortable]").forEach((function(header){header.style.cursor="pointer",header.addEventListener("click",(function(){var column=this.getAttribute("data-sortable");currentSort.column===column?currentSort.direction="ASC"===currentSort.direction?"DESC":"ASC":(currentSort.column=column,currentSort.direction="ASC"),applyFilters()}))}))},attachPaginationHandlers=function(){document.querySelectorAll("[data-page]").forEach((function(link){link.addEventListener("click",(function(e){e.preventDefault();var page=parseInt(this.getAttribute("data-page"),10);page>0&&navigateToPage(page)}))}))},applyFilters=function(){var params=buildUrlParams(),url=buildUrl(params);window.location.href=url},clearFilters=function(){var url=buildUrl({id:cmid,sessionid:sessionid});window.location.href=url},navigateToPage=function(page){var params=buildUrlParams();params.page=page;var url=buildUrl(params);window.location.href=url},buildUrlParams=function(){var params={id:cmid,sessionid:sessionid},nameSearch=document.getElementById("filter-namesearch");nameSearch&&""!==nameSearch.value.trim()&&(params.namesearch=nameSearch.value.trim());var minScore=document.getElementById("filter-minscore");minScore&&""!==minScore.value&&(params.minscore=minScore.value);var maxScore=document.getElementById("filter-maxscore");maxScore&&""!==maxScore.value&&(params.maxscore=maxScore.value);var minTime=document.getElementById("filter-mintime");minTime&&""!==minTime.value&&(params.mintime=minTime.value);var maxTime=document.getElementById("filter-maxtime");maxTime&&""!==maxTime.value&&(params.maxtime=maxTime.value);var topOnly=document.getElementById("filter-toponly");topOnly&&topOnly.checked&&(params.toponly=1);var questionFilter=document.getElementById("filter-questionid");questionFilter&&""!==questionFilter.value&&"0"!==questionFilter.value&&(params.questionid=questionFilter.value),""!==currentSort.column&&(params.sort=currentSort.column,params.dir=currentSort.direction);var perPage=document.getElementById("filter-perpage");perPage&&""!==perPage.value&&(params.perpage=perPage.value);var currentPage=getCurrentPage();return currentPage>1&&(params.page=currentPage),params},getCurrentPage=function(){var urlParams=new URLSearchParams(window.location.search),page=parseInt(urlParams.get("page"),10);return isNaN(page)||page<1?1:page},buildUrl=function(params){return window.location.pathname+"?"+Object.keys(params).map((function(key){return encodeURIComponent(key)+"="+encodeURIComponent(params[key])})).join("&")},initializeSortState=function(){var urlParams=new URLSearchParams(window.location.search),sortColumn=urlParams.get("sort"),sortDirection=urlParams.get("dir");sortColumn&&(currentSort.column=sortColumn,currentSort.direction="DESC"===sortDirection?"DESC":"ASC",updateSortIndicators())},updateSortIndicators=function(){document.querySelectorAll("[data-sortable]").forEach((function(header){var column=header.getAttribute("data-sortable"),existingIndicator=header.querySelector(".sort-indicator");if(existingIndicator&&existingIndicator.remove(),column===currentSort.column){var indicator=document.createElement("span");indicator.className="sort-indicator",indicator.innerHTML="ASC"===currentSort.direction?" ▲":" ▼",header.appendChild(indicator)}}))};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeSortState):initializeSortState(),{init:function(courseModuleId,selectedSessionId){cmid=courseModuleId,sessionid=selectedSessionId,attachFilterHandlers(),attachSortHandlers(),attachPaginationHandlers()}}}));

//# sourceMappingURL=analytics_filters.min.js.map