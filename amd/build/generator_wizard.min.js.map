{"version":3,"file":"generator_wizard.min.js","sources":["../src/generator_wizard.js"],"sourcesContent":["define([\n  \"jquery\",\n  \"core/modal_factory\",\n  \"core/modal_events\",\n  \"core/templates\",\n  \"core/ajax\",\n  \"core/notification\",\n  \"core/str\",\n], function ($, ModalFactory, ModalEvents, Templates, Ajax, Notification, Str) {\n  var GeneratorWizard = {\n    modal: null,\n    cmid: null,\n    slideid: null,\n    docid: null,\n    pages: [],\n\n    init: function (cmid) {\n      this.cmid = cmid;\n\n      // Event delegation for the Generate button on slides page\n      $(document).on(\n        \"click\",\n        '[data-action=\"open-generator\"]',\n        function (e) {\n          e.preventDefault();\n          var btn = $(e.currentTarget);\n          this.slideid = btn.data(\"slideid\");\n          this.openWizard();\n        }.bind(this),\n      );\n    },\n\n    openWizard: function () {\n      var self = this;\n\n      ModalFactory.create({\n        type: ModalFactory.types.DEFAULT,\n        large: true,\n      })\n        .then(function (modal) {\n          self.modal = modal;\n\n          // Set Title\n          Str.get_string(\"generatefromdocument\", \"mod_classengage\").then(\n            function (title) {\n              modal.setTitle(title);\n            },\n          );\n\n          // Set Body\n          Templates.render(\"mod_classengage/generator_wizard\", {\n            numquestions_options: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 20],\n          }).then(function (html, js) {\n            modal.setBody(html);\n            Templates.runTemplateJS(js);\n          });\n\n          // Set Footer\n          Templates.render(\"mod_classengage/generator_wizard_footer\", {}).then(\n            function (html, js) {\n              modal.setFooter(html);\n              Templates.runTemplateJS(js);\n            },\n          );\n\n          modal.show();\n\n          // Start Inspection\n          self.inspectDocument();\n\n          // Bind Modal Events\n          var root = modal.getRoot();\n\n          // Range Input Handler\n          root.on(\"change\", \"#id_pagerange\", function () {\n            self.updateSelectionFromRange($(this).val());\n          });\n\n          // Select All Handler\n          root.on(\"change\", \"#select-all-slides\", function () {\n            var checked = $(this).is(\":checked\");\n            root.find(\".slide-toggle\").prop(\"checked\", checked);\n          });\n\n          // Select All Images Handler\n          root.on(\"change\", \"#select-all-images\", function () {\n            var checked = $(this).is(\":checked\");\n            root.find(\".image-toggle\").prop(\"checked\", checked);\n          });\n\n          // Generate Confirm Click\n          // Note: Footer is separate now, so we need to target it specifically or search in root\n          // Modal root usually contains footer\n          root.on(\"click\", \"#btn-generate-confirm\", function () {\n            self.triggerGeneration();\n          });\n\n          // Cancel Button Handler - works at all stages\n          root.on(\"click\", '[data-action=\"cancel\"]', function () {\n            self.modal.hide();\n            $(\"#generator-floater\").remove();\n          });\n\n          // Show More Text\n          root.on(\"click\", \".show-more-text\", function (e) {\n            e.preventDefault();\n            var link = $(this);\n            alert(link.data(\"fulltext\"));\n          });\n\n          // Auto-Show Distribution on Dropdown Change\n          root.on(\n            \"change\",\n            \"#id_difficulty, #id_cognitive, #id_numquestions\",\n            function () {\n              self.checkDistributionVisibility();\n            },\n          );\n\n          // Manual Input Change -> Validate\n          root.on(\"input\", \".dist-input\", function () {\n            self.validateDistribution();\n          });\n        })\n        .fail(Notification.exception);\n    },\n\n    inspectDocument: function () {\n      var self = this;\n\n      Ajax.call([\n        {\n          methodname: \"mod_classengage_inspect_document\", // We don't have a webservice, using direct AJAX script\n          args: {}, // Not used for script call\n        },\n      ]);\n\n      // Using direct fetch to slides_api.php as we did before, but cleaner\n      // Moodle 4.x prefers service calls, but we are using existing pattern for now.\n      // Actually, we should use Ajax.call if it was a WS. Since it's a script, we use jQuery.ajax\n      // BUT core/ajax is better for session handling.\n      // Let's use simple $.ajax to our endpoint.\n\n      $.ajax({\n        url: M.cfg.wwwroot + \"/mod/classengage/slides_api.php\",\n        data: {\n          action: \"inspect\",\n          slideid: self.slideid,\n          sesskey: M.cfg.sesskey,\n        },\n        dataType: \"json\",\n        success: function (response) {\n          if (response.success) {\n            self.docid = response.docid;\n            self.pages = response.pages;\n            self.renderPages();\n          } else {\n            self.modal.setBody(\n              '<div class=\"alert alert-danger\">' + response.error + \"</div>\",\n            );\n          }\n        },\n        error: function () {\n          self.modal.setBody(\n            '<div class=\"alert alert-danger\">Network error during inspection.</div>',\n          );\n        },\n      });\n    },\n\n    renderPages: function () {\n      var self = this;\n      var container = self.modal.getRoot().find(\"#slides-container\");\n      container.empty();\n\n      var context = { pages: [] };\n\n      // Process pages for template\n      this.pages.forEach(function (page) {\n        var shorttext = page.text.replace(/<[^>]+>/g, \"\").substring(0, 100);\n        var images = [];\n\n        if (page.images) {\n          page.images.forEach(function (img) {\n            // We need safe source for ID\n            // We can't use bin2hex easily in JS consistently with PHP without library\n            // But we can just use a sanitised string or index if needed.\n            // Actually, let's just use the source string and hope it works in HTML attribute (it should if quoted)\n            // Wait, previous issue was PHP array keys. We are sending JSON now.\n            // JSON keys can be anything. So we don't need hex encoding here!\n            images.push({\n              source: img.source,\n              safe_source: img.source, // No hex needed for JSON payload\n              mediaType: img.mediaType,\n              data: img.data,\n            });\n          });\n        }\n\n        self.modal\n          .getRoot()\n          .find(\"#slides-container\")\n          .append(\n            Templates.render(\"mod_classengage/generator_slide_row\", {\n              pagenum: page.page,\n              shorttext: shorttext,\n              fulltext: page.text, // For popup\n              hasmore: page.text.length > 100,\n              images: images,\n            }),\n          );\n      });\n\n      // Since Templates.render returns a promise when directly appended, we might have issues?\n      // \"Templates.render\" returns a promise that resolves to (html, js).\n      // Better to use renderForPromise logic or wait.\n\n      // Correct approach:\n      var promises = [];\n      this.pages.forEach(function (page) {\n        var shorttext = page.text.replace(/<[^>]+>/g, \"\").substring(0, 100);\n        var images = [];\n        if (page.images) {\n          page.images.forEach(function (img) {\n            images.push({\n              imageId: img.imageId || img.source, // Use imageId if available, fallback to source\n              source: img.source,\n              url: img.url, // URL for image delivery\n              label: img.label,\n              mediaType: img.mediaType,\n              data: img.data, // Legacy Base64 fallback\n            });\n          });\n        }\n\n        promises.push(\n          Templates.render(\"mod_classengage/generator_slide_row\", {\n            pagenum: page.page,\n            shorttext: shorttext,\n            fulltext: page.text,\n            hasmore: page.text.length > 100,\n            images: images,\n          }),\n        );\n      });\n\n      $.when.apply($, promises).done(function () {\n        var args = arguments;\n        // args is array of [html, js] pairs if multiple, or just [html, js] if one?\n        // jQuery when with array is tricky.\n\n        // Let's iterate simply.\n        // Actually, renderForPromise is safer if we want to batch.\n        // But let's just append sequentially for simplicity in this V1.\n\n        // Reset content\n        container.empty();\n        // Show content, hide loading\n        self.modal.getRoot().find(\"#generator-loading\").addClass(\"d-none\");\n        self.modal.getRoot().find(\"#generator-content\").removeClass(\"d-none\");\n        self.modal\n          .getRoot()\n          .find(\"#btn-generate-confirm\")\n          .prop(\"disabled\", false);\n\n        for (var i = 0; i < promises.length; i++) {\n          // If multiple promises, 'arguments' has subarray for each\n          // If one promise, 'arguments' is [html, js]\n          var result = promises.length > 1 ? arguments[i] : arguments;\n          container.append(result[0]);\n          Templates.runTemplateJS(result[1]);\n        }\n      });\n    },\n\n    checkDistributionVisibility: function () {\n      var root = this.modal.getRoot();\n      var diff = root.find(\"#id_difficulty\").val();\n      var bloom = root.find(\"#id_cognitive\").val();\n      var num = parseInt(root.find(\"#id_numquestions\").val());\n\n      var showPanel = false;\n\n      // Difficulty Distribution\n      if (diff === \"mixed\") {\n        root.find(\"#difficulty-dist\").removeClass(\"d-none\").addClass(\"d-block\");\n        showPanel = true;\n        // Only distribute if total is 0 (first time show) or if total doesn't match\n        if (this.getSum(\"difficulty\") !== num) {\n          this.distributeEvenly(\"difficulty\", num);\n        }\n      } else {\n        root.find(\"#difficulty-dist\").removeClass(\"d-block\").addClass(\"d-none\");\n      }\n\n      // Bloom Distribution\n      if (bloom === \"mixed\") {\n        root.find(\"#cognitive-dist\").removeClass(\"d-none\").addClass(\"d-block\");\n        showPanel = true;\n        if (this.getSum(\"bloom\") !== num) {\n          this.distributeEvenly(\"bloom\", num);\n        }\n      } else {\n        root.find(\"#cognitive-dist\").removeClass(\"d-block\").addClass(\"d-none\");\n      }\n\n      if (showPanel) {\n        root.find(\"#advanced-distribution-panel\").removeClass(\"d-none\");\n      } else {\n        root.find(\"#advanced-distribution-panel\").addClass(\"d-none\");\n      }\n\n      this.validateDistribution();\n    },\n\n    getSum: function (type) {\n      var sum = 0;\n      this.modal\n        .getRoot()\n        .find('.dist-input[data-type=\"' + type + '\"]')\n        .each(function () {\n          sum += parseInt($(this).val()) || 0;\n        });\n      return sum;\n    },\n\n    distributeEvenly: function (type, total) {\n      var inputs = this.modal\n        .getRoot()\n        .find('.dist-input[data-type=\"' + type + '\"]');\n      var count = inputs.length;\n      var base = Math.floor(total / count);\n      var remainder = total % count;\n\n      inputs.each(function (index) {\n        var val = base + (index < remainder ? 1 : 0);\n        $(this).val(val);\n      });\n    },\n\n    validateDistribution: function () {\n      var root = this.modal.getRoot();\n      var totalTarget = parseInt(root.find(\"#id_numquestions\").val());\n      var valid = true;\n\n      // Check if panel is visible\n      if (root.find(\"#advanced-distribution-panel\").hasClass(\"d-none\")) {\n        root.find(\"#btn-generate-confirm\").prop(\"disabled\", false);\n        return true;\n      }\n\n      // Validate Difficulty if visible\n      if (!root.find(\"#difficulty-dist\").hasClass(\"d-none\")) {\n        var diffSum = this.getSum(\"difficulty\");\n        if (diffSum !== totalTarget) {\n          root\n            .find(\"#diff-validation-msg\")\n            .removeClass(\"d-none\")\n            .text(\"Sum: \" + diffSum + \" / \" + totalTarget);\n          valid = false;\n        } else {\n          root.find(\"#diff-validation-msg\").addClass(\"d-none\");\n        }\n      }\n\n      // Validate Bloom if visible\n      if (!root.find(\"#cognitive-dist\").hasClass(\"d-none\")) {\n        var bloomSum = this.getSum(\"bloom\");\n        if (bloomSum !== totalTarget) {\n          root\n            .find(\"#bloom-validation-msg\")\n            .removeClass(\"d-none\")\n            .text(\"Sum: \" + bloomSum + \" / \" + totalTarget);\n          valid = false;\n        } else {\n          root.find(\"#bloom-validation-msg\").addClass(\"d-none\");\n        }\n      }\n\n      root.find(\"#btn-generate-confirm\").prop(\"disabled\", !valid);\n      return valid;\n    },\n\n    updateSelectionFromRange: function (rangeStr) {\n      if (!rangeStr) {\n        return;\n      }\n\n      var root = this.modal.getRoot();\n      // Uncheck all first\n      root.find(\".slide-toggle\").prop(\"checked\", false);\n\n      var parts = rangeStr.split(\",\");\n      parts.forEach(function (part) {\n        var bounds = part.trim().split(\"-\");\n        if (bounds.length === 2) {\n          var start = parseInt(bounds[0]);\n          var end = parseInt(bounds[1]);\n          for (var i = start; i <= end; i++) {\n            root\n              .find('.slide-row[data-page=\"' + i + '\"] .slide-toggle')\n              .prop(\"checked\", true);\n          }\n        } else if (bounds.length === 1 && bounds[0] !== \"\") {\n          var p = parseInt(bounds[0]);\n          root\n            .find('.slide-row[data-page=\"' + p + '\"] .slide-toggle')\n            .prop(\"checked\", true);\n        }\n      });\n    },\n\n    triggerGeneration: function () {\n      var self = this;\n      var root = self.modal.getRoot();\n\n      // Collect Options\n      var numQuestions = parseInt(root.find(\"#id_numquestions\").val());\n      var difficulty = root.find(\"#id_difficulty\").val();\n      var bloomLevel = root.find(\"#id_cognitive\").val();\n\n      var difficultyDistribution = null;\n      var bloomDistribution = null;\n\n      if (difficulty === \"mixed\") {\n        difficultyDistribution = {};\n        root.find('.dist-input[data-type=\"difficulty\"]').each(function () {\n          difficultyDistribution[$(this).data(\"key\")] =\n            parseInt($(this).val()) || 0;\n        });\n      }\n\n      if (bloomLevel === \"mixed\") {\n        bloomDistribution = {};\n        root.find('.dist-input[data-type=\"bloom\"]').each(function () {\n          bloomDistribution[$(this).data(\"key\")] = parseInt($(this).val()) || 0;\n        });\n      }\n\n      var includeSlides = [];\n      root.find(\".slide-toggle:checked\").each(function () {\n        var row = $(this).closest(\".slide-row\");\n        includeSlides.push(row.data(\"page\"));\n      });\n\n      var includeImages = [];\n      root.find(\".image-toggle:checked\").each(function () {\n        var imageId = $(this).data(\"imageid\");\n        if (imageId) {\n          includeImages.push(imageId);\n        } else {\n          var source = $(this).data(\"source\");\n          if (source) {\n            includeImages.push(source);\n          }\n        }\n      });\n\n      var options = {\n        numQuestions: numQuestions,\n        difficulty: difficulty,\n        bloomLevel: bloomLevel,\n        includeSlides: includeSlides,\n        includeImages: includeImages,\n      };\n\n      if (difficultyDistribution) {\n        options.difficultyDistribution = difficultyDistribution;\n      }\n      if (bloomDistribution) {\n        options.bloomDistribution = bloomDistribution;\n      }\n\n      // UI Loading state\n      root\n        .find(\"#btn-generate-confirm\")\n        .prop(\"disabled\", true)\n        .html('<i class=\"fa fa-spinner fa-spin\"></i> Initializing...');\n\n      // Switch to Progress UI\n      root.find(\"#generator-content\").addClass(\"d-none\");\n      root.find(\"#generator-progress\").removeClass(\"d-none\");\n      self.modal.getFooter().find(\"#btn-generate-confirm\").hide();\n\n      // Initialize Progress\n      if (self.updateProgress) {\n        self.updateProgress(0, \"Sending request...\");\n      }\n\n      // Bind Minimize Button\n      root\n        .off(\"click\", \"#btn-minimize-progress\")\n        .on(\"click\", \"#btn-minimize-progress\", function () {\n          self.minimizeModal();\n        });\n\n      // Step 1: Start the Job (Non-blocking)\n      $.ajax({\n        url: M.cfg.wwwroot + \"/mod/classengage/slides_api.php\",\n        type: \"POST\",\n        data: {\n          action: \"generate_from_options\",\n          slideid: self.slideid,\n          docid: self.docid,\n          options: JSON.stringify(options),\n          sesskey: M.cfg.sesskey,\n        },\n        dataType: \"json\",\n        success: function (response) {\n          if (response.success && response.status === \"running\") {\n            // Job started, begin Smart Polling\n            self.updateProgress(5, \"Job queued...\");\n            self.pollStatus(0);\n          } else if (response.success && response.status === \"completed\") {\n            self.updateProgress(100, \"Done!\");\n            self.showSuccess(response);\n          } else {\n            self.showError(\n              response.error || \"Unknown error starting generation\",\n            );\n          }\n        },\n        error: function () {\n          self.showError(\"Network error starting generation.\");\n        },\n      });\n    },\n\n    updateProgress: function (percent, statusText) {\n      var root = this.modal.getRoot();\n      var bar = root.find(\"#progress-bar\");\n      bar.css(\"width\", percent + \"%\");\n      bar.text(percent + \"%\");\n      bar.attr(\"aria-valuenow\", percent);\n\n      if (statusText) {\n        root.find(\"#progress-status-text\").text(statusText);\n        if (percent < 20) {\n          root.find(\"#progress-detail\").text(\"Initializing NLP Engine...\");\n        } else if (percent < 50) {\n          root.find(\"#progress-detail\").text(\"Analyzing content...\");\n        } else if (percent < 80) {\n          root.find(\"#progress-detail\").text(\"Generating questions...\");\n        } else if (percent < 100) {\n          root.find(\"#progress-detail\").text(\"Finalizing...\");\n        }\n      }\n    },\n\n    minimizeModal: function () {\n      var self = this;\n      this.modal.hide();\n\n      if ($(\"#generator-floater\").length === 0) {\n        $(\"body\").append(\n          '<div id=\"generator-floater\" style=\"position: fixed; bottom: 20px; ' +\n            'right: 20px; z-index: 1050; box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: pointer;\">' +\n            '  <button class=\"btn btn-primary rounded-pill px-4 py-2 font-weight-bold\">' +\n            '    <i class=\"fa fa-spinner fa-spin mr-2\"></i> Generating <span id=\"floater-percent\">0%</span>' +\n            \"  </button>\" +\n            \"</div>\",\n        );\n\n        $(\"#generator-floater\").on(\"click\", function () {\n          self.modal.show();\n          $(this).hide();\n        });\n      }\n\n      var percent =\n        this.modal.getRoot().find(\"#progress-bar\").attr(\"aria-valuenow\") || 0;\n      $(\"#floater-percent\").text(percent + \"%\");\n      $(\"#generator-floater\").show();\n    },\n\n    // Recursive Smart Polling\n    pollStatus: function (retryCount) {\n      var self = this;\n      var root = self.modal.getRoot();\n\n      // Use wait=true to enable server-side long polling (15s hold)\n      $.ajax({\n        url: M.cfg.wwwroot + \"/mod/classengage/slides_api.php\",\n        type: \"GET\",\n        data: {\n          action: \"nlpstatus\",\n          slideid: self.slideid,\n          sesskey: M.cfg.sesskey,\n          wait: true, // Enable Long Polling\n        },\n        dataType: \"json\",\n        timeout: 40000, // 40s timeout (server holds for 15s + buffer)\n        success: function (response) {\n          if (response.success) {\n            if (response.status === \"completed\") {\n              self.updateProgress(100, \"Generation Complete!\");\n              self.showSuccess(response);\n              if ($(\"#generator-floater\").is(\":visible\")) {\n                $(\"#generator-floater\").html(\n                  '<button class=\"btn btn-success rounded-pill px-4 py-2 font-weight-bold\">' +\n                    '<i class=\"fa fa-check\"></i> Complete!</button>',\n                );\n              }\n            } else if (response.status === \"failed\") {\n              self.showError(response.error);\n            } else {\n              // Still running - update UI and poll again IMMEDIATELY\n              var progress = response.progress || 0;\n              if (progress < 10) {\n                progress = 10;\n              }\n\n              self.updateProgress(progress, \"Generating...\");\n              $(\"#floater-percent\").text(progress + \"%\");\n\n              // Call immediately for next long-poll window\n              self.pollStatus(0);\n            }\n          } else {\n            // Logic error - retry with backoff\n            setTimeout(function () {\n              self.pollStatus(retryCount);\n            }, 2000);\n          }\n        },\n        error: function (xhr, status, error) {\n          // Network error or timeout - retry with backoff\n          if (retryCount > 10) {\n            self.showError(\"Connection lost. Please refresh the page.\");\n          } else {\n            console.warn(\"Poll failed, retrying...\", status, error);\n            setTimeout(\n              function () {\n                self.pollStatus(retryCount + 1);\n              },\n              2000 + retryCount * 1000,\n            );\n          }\n        },\n      });\n    },\n\n    showError: function (msg) {\n      var root = this.modal.getRoot();\n      // Switch back to error UI in progress container\n      root.find(\"#progress-status-text\").text(\"Error Failed\");\n      root\n        .find(\"#progress-bar\")\n        .addClass(\"bg-danger\")\n        .removeClass(\"progress-bar-animated\");\n      root.find(\"#progress-detail\").text(msg).addClass(\"text-danger\");\n      alert(\"Error: \" + msg);\n    },\n\n    showSuccess: function (response) {\n      var self = this;\n      var root = self.modal.getRoot();\n\n      // Build success summary - clean, professional layout\n      var summaryHtml =\n        '<div class=\"text-center p-4\">' +\n        '<div class=\"text-success mb-3\"><i class=\"fa fa-check-circle fa-4x\"></i></div>' +\n        \"<h4>Questions Ready!</h4>\" +\n        '<p class=\"lead mb-3\">' +\n        \"<strong>\" +\n        response.count +\n        \"</strong> questions have been generated.</p>\";\n\n      // Info line: provider + duration in a clean row\n      summaryHtml += '<div class=\"mb-4\">';\n\n      // Provider + Model badge\n      if (response.provider) {\n        var providerText = response.provider;\n        if (response.model) {\n          providerText += \" (\" + response.model + \")\";\n        }\n        summaryHtml +=\n          '<span class=\"badge badge-dark mr-2\">' +\n          '<i class=\"fa fa-robot mr-1\"></i>' +\n          providerText +\n          \"</span>\";\n      }\n\n      // Duration\n      if (response.duration) {\n        var mins = Math.floor(response.duration / 60);\n        var secs = response.duration % 60;\n        var durationStr = mins > 0 ? mins + \"m \" + secs + \"s\" : secs + \"s\";\n        summaryHtml +=\n          '<span class=\"text-muted small\">' +\n          '<i class=\"fa fa-clock-o mr-1\"></i>Generated in ' +\n          durationStr +\n          \"</span>\";\n      }\n\n      summaryHtml += \"</div>\";\n\n      // View Questions button - navigate to questions.php with highlight\n      var questionsUrl =\n        M.cfg.wwwroot +\n        \"/mod/classengage/questions.php?id=\" +\n        self.cmid +\n        \"&highlight=slide_\" +\n        self.slideid;\n\n      summaryHtml +=\n        '<div class=\"mt-3\">' +\n        '<a href=\"' +\n        questionsUrl +\n        '\" class=\"btn btn-primary btn-lg\">' +\n        '<i class=\"fa fa-eye mr-2\"></i>View Questions</a>' +\n        \"</div>\" +\n        \"</div>\";\n\n      root.find(\"#generator-progress\").html(summaryHtml);\n\n      root.find(\"#btn-minimize-progress\").remove();\n      $(\"#generator-floater\").remove();\n    },\n  };\n\n  return GeneratorWizard;\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","Ajax","Notification","Str","GeneratorWizard","modal","cmid","slideid","docid","pages","init","document","on","e","preventDefault","btn","currentTarget","data","openWizard","bind","this","self","create","type","types","DEFAULT","large","then","get_string","title","setTitle","render","numquestions_options","html","js","setBody","runTemplateJS","setFooter","show","inspectDocument","root","getRoot","updateSelectionFromRange","val","checked","is","find","prop","triggerGeneration","hide","remove","link","alert","checkDistributionVisibility","validateDistribution","fail","exception","call","methodname","args","ajax","url","M","cfg","wwwroot","action","sesskey","dataType","success","response","renderPages","error","container","empty","forEach","page","shorttext","text","replace","substring","images","img","push","source","safe_source","mediaType","append","pagenum","fulltext","hasmore","length","promises","imageId","label","when","apply","done","addClass","removeClass","i","result","arguments","diff","bloom","num","parseInt","showPanel","getSum","distributeEvenly","sum","each","total","inputs","count","base","Math","floor","remainder","index","totalTarget","valid","hasClass","diffSum","bloomSum","rangeStr","split","part","bounds","trim","start","end","p","numQuestions","difficulty","bloomLevel","difficultyDistribution","bloomDistribution","includeSlides","row","closest","includeImages","options","getFooter","updateProgress","off","minimizeModal","JSON","stringify","status","pollStatus","showSuccess","showError","percent","statusText","bar","css","attr","retryCount","wait","timeout","progress","setTimeout","xhr","console","warn","msg","summaryHtml","provider","providerText","model","duration","mins","secs"],"mappings":"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"}