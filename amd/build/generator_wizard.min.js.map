{"version":3,"file":"generator_wizard.min.js","sources":["../src/generator_wizard.js"],"sourcesContent":["define([\n  \"jquery\",\n  \"core/modal_factory\",\n  \"core/modal_events\",\n  \"core/templates\",\n  \"core/ajax\",\n  \"core/notification\",\n  \"core/str\",\n], function ($, ModalFactory, ModalEvents, Templates, Ajax, Notification, Str) {\n  var GeneratorWizard = {\n    modal: null,\n    cmid: null,\n    slideid: null,\n    docid: null,\n    pages: [],\n\n    init: function (cmid) {\n      this.cmid = cmid;\n\n      // Event delegation for the Generate button on slides page\n      $(document).on(\n        \"click\",\n        '[data-action=\"open-generator\"]',\n        function (e) {\n          e.preventDefault();\n          var btn = $(e.currentTarget);\n          this.slideid = btn.data(\"slideid\");\n          this.openWizard();\n        }.bind(this)\n      );\n    },\n\n    openWizard: function () {\n      var self = this;\n\n      ModalFactory.create({\n        type: ModalFactory.types.DEFAULT,\n        large: true,\n      })\n        .then(function (modal) {\n          self.modal = modal;\n\n          // Set Title\n          Str.get_string(\"generatefromdocument\", \"mod_classengage\").then(\n            function (title) {\n              modal.setTitle(title);\n            }\n          );\n\n          // Set Body\n          Templates.render(\"mod_classengage/generator_wizard\", {\n            numquestions_options: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 20],\n          }).then(function (html, js) {\n            modal.setBody(html);\n            Templates.runTemplateJS(js);\n          });\n\n          // Set Footer\n          Templates.render(\"mod_classengage/generator_wizard_footer\", {}).then(\n            function (html, js) {\n              modal.setFooter(html);\n              Templates.runTemplateJS(js);\n            }\n          );\n\n          modal.show();\n\n          // Start Inspection\n          self.inspectDocument();\n\n          // Bind Modal Events\n          var root = modal.getRoot();\n\n          // Range Input Handler\n          root.on(\"change\", \"#id_pagerange\", function () {\n            self.updateSelectionFromRange($(this).val());\n          });\n\n          // Select All Handler\n          root.on(\"change\", \"#select-all-slides\", function () {\n            var checked = $(this).is(\":checked\");\n            root.find(\".slide-toggle\").prop(\"checked\", checked);\n          });\n\n          // Select All Images Handler\n          root.on(\"change\", \"#select-all-images\", function () {\n            var checked = $(this).is(\":checked\");\n            root.find(\".image-toggle\").prop(\"checked\", checked);\n          });\n\n          // Generate Confirm Click\n          // Note: Footer is separate now, so we need to target it specifically or search in root\n          // Modal root usually contains footer\n          root.on(\"click\", \"#btn-generate-confirm\", function () {\n            self.triggerGeneration();\n          });\n\n          // Show More Text\n          root.on(\"click\", \".show-more-text\", function (e) {\n            e.preventDefault();\n            var link = $(this);\n            alert(link.data(\"fulltext\"));\n          });\n\n          // Auto-Show Distribution on Dropdown Change\n          root.on(\n            \"change\",\n            \"#id_difficulty, #id_cognitive, #id_numquestions\",\n            function () {\n              self.checkDistributionVisibility();\n            }\n          );\n\n          // Manual Input Change -> Validate\n          root.on(\"input\", \".dist-input\", function () {\n            self.validateDistribution();\n          });\n        })\n        .fail(Notification.exception);\n    },\n\n    inspectDocument: function () {\n      var self = this;\n\n      Ajax.call([\n        {\n          methodname: \"mod_classengage_inspect_document\", // We don't have a webservice, using direct AJAX script\n          args: {}, // Not used for script call\n        },\n      ]);\n\n      // Using direct fetch to slides_api.php as we did before, but cleaner\n      // Moodle 4.x prefers service calls, but we are using existing pattern for now.\n      // Actually, we should use Ajax.call if it was a WS. Since it's a script, we use jQuery.ajax\n      // BUT core/ajax is better for session handling.\n      // Let's use simple $.ajax to our endpoint.\n\n      $.ajax({\n        url: M.cfg.wwwroot + \"/mod/classengage/slides_api.php\",\n        data: {\n          action: \"inspect\",\n          slideid: self.slideid,\n          sesskey: M.cfg.sesskey,\n        },\n        dataType: \"json\",\n        success: function (response) {\n          if (response.success) {\n            self.docid = response.docid;\n            self.pages = response.pages;\n            self.renderPages();\n          } else {\n            self.modal.setBody(\n              '<div class=\"alert alert-danger\">' + response.error + \"</div>\"\n            );\n          }\n        },\n        error: function () {\n          self.modal.setBody(\n            '<div class=\"alert alert-danger\">Network error during inspection.</div>'\n          );\n        },\n      });\n    },\n\n    renderPages: function () {\n      var self = this;\n      var container = self.modal.getRoot().find(\"#slides-container\");\n      container.empty();\n\n      var context = { pages: [] };\n\n      // Process pages for template\n      this.pages.forEach(function (page) {\n        var shorttext = page.text.replace(/<[^>]+>/g, \"\").substring(0, 100);\n        var images = [];\n\n        if (page.images) {\n          page.images.forEach(function (img) {\n            // We need safe source for ID\n            // We can't use bin2hex easily in JS consistently with PHP without library\n            // But we can just use a sanitised string or index if needed.\n            // Actually, let's just use the source string and hope it works in HTML attribute (it should if quoted)\n            // Wait, previous issue was PHP array keys. We are sending JSON now.\n            // JSON keys can be anything. So we don't need hex encoding here!\n            images.push({\n              source: img.source,\n              safe_source: img.source, // No hex needed for JSON payload\n              mediaType: img.mediaType,\n              data: img.data,\n            });\n          });\n        }\n\n        self.modal\n          .getRoot()\n          .find(\"#slides-container\")\n          .append(\n            Templates.render(\"mod_classengage/generator_slide_row\", {\n              pagenum: page.page,\n              shorttext: shorttext,\n              fulltext: page.text, // For popup\n              hasmore: page.text.length > 100,\n              images: images,\n            })\n          );\n      });\n\n      // Since Templates.render returns a promise when directly appended, we might have issues?\n      // \"Templates.render\" returns a promise that resolves to (html, js).\n      // Better to use renderForPromise logic or wait.\n\n      // Correct approach:\n      var promises = [];\n      this.pages.forEach(function (page) {\n        var shorttext = page.text.replace(/<[^>]+>/g, \"\").substring(0, 100);\n        var images = [];\n        if (page.images) {\n          page.images.forEach(function (img) {\n            images.push({\n              imageId: img.imageId || img.source, // Use imageId if available, fallback to source\n              source: img.source,\n              url: img.url, // URL for image delivery\n              label: img.label,\n              mediaType: img.mediaType,\n              data: img.data, // Legacy Base64 fallback\n            });\n          });\n        }\n\n        promises.push(\n          Templates.render(\"mod_classengage/generator_slide_row\", {\n            pagenum: page.page,\n            shorttext: shorttext,\n            fulltext: page.text,\n            hasmore: page.text.length > 100,\n            images: images,\n          })\n        );\n      });\n\n      $.when.apply($, promises).done(function () {\n        var args = arguments;\n        // args is array of [html, js] pairs if multiple, or just [html, js] if one?\n        // jQuery when with array is tricky.\n\n        // Let's iterate simply.\n        // Actually, renderForPromise is safer if we want to batch.\n        // But let's just append sequentially for simplicity in this V1.\n\n        // Reset content\n        container.empty();\n        // Show content, hide loading\n        self.modal.getRoot().find(\"#generator-loading\").addClass(\"d-none\");\n        self.modal.getRoot().find(\"#generator-content\").removeClass(\"d-none\");\n        self.modal\n          .getRoot()\n          .find(\"#btn-generate-confirm\")\n          .prop(\"disabled\", false);\n\n        for (var i = 0; i < promises.length; i++) {\n          // If multiple promises, 'arguments' has subarray for each\n          // If one promise, 'arguments' is [html, js]\n          var result = promises.length > 1 ? arguments[i] : arguments;\n          container.append(result[0]);\n          Templates.runTemplateJS(result[1]);\n        }\n      });\n    },\n\n    checkDistributionVisibility: function () {\n      var root = this.modal.getRoot();\n      var diff = root.find(\"#id_difficulty\").val();\n      var bloom = root.find(\"#id_cognitive\").val();\n      var num = parseInt(root.find(\"#id_numquestions\").val());\n\n      var showPanel = false;\n\n      // Difficulty Distribution\n      if (diff === \"mixed\") {\n        root.find(\"#difficulty-dist\").removeClass(\"d-none\").addClass(\"d-block\");\n        showPanel = true;\n        // Only distribute if total is 0 (first time show) or if total doesn't match\n        if (this.getSum(\"difficulty\") !== num) {\n          this.distributeEvenly(\"difficulty\", num);\n        }\n      } else {\n        root.find(\"#difficulty-dist\").removeClass(\"d-block\").addClass(\"d-none\");\n      }\n\n      // Bloom Distribution\n      if (bloom === \"mixed\") {\n        root.find(\"#cognitive-dist\").removeClass(\"d-none\").addClass(\"d-block\");\n        showPanel = true;\n        if (this.getSum(\"bloom\") !== num) {\n          this.distributeEvenly(\"bloom\", num);\n        }\n      } else {\n        root.find(\"#cognitive-dist\").removeClass(\"d-block\").addClass(\"d-none\");\n      }\n\n      if (showPanel) {\n        root.find(\"#advanced-distribution-panel\").removeClass(\"d-none\");\n      } else {\n        root.find(\"#advanced-distribution-panel\").addClass(\"d-none\");\n      }\n\n      this.validateDistribution();\n    },\n\n    getSum: function (type) {\n      var sum = 0;\n      this.modal\n        .getRoot()\n        .find('.dist-input[data-type=\"' + type + '\"]')\n        .each(function () {\n          sum += parseInt($(this).val()) || 0;\n        });\n      return sum;\n    },\n\n    distributeEvenly: function (type, total) {\n      var inputs = this.modal\n        .getRoot()\n        .find('.dist-input[data-type=\"' + type + '\"]');\n      var count = inputs.length;\n      var base = Math.floor(total / count);\n      var remainder = total % count;\n\n      inputs.each(function (index) {\n        var val = base + (index < remainder ? 1 : 0);\n        $(this).val(val);\n      });\n    },\n\n    validateDistribution: function () {\n      var root = this.modal.getRoot();\n      var totalTarget = parseInt(root.find(\"#id_numquestions\").val());\n      var valid = true;\n\n      // Check if panel is visible\n      if (root.find(\"#advanced-distribution-panel\").hasClass(\"d-none\")) {\n        root.find(\"#btn-generate-confirm\").prop(\"disabled\", false);\n        return true;\n      }\n\n      // Validate Difficulty if visible\n      if (!root.find(\"#difficulty-dist\").hasClass(\"d-none\")) {\n        var diffSum = this.getSum(\"difficulty\");\n        if (diffSum !== totalTarget) {\n          root\n            .find(\"#diff-validation-msg\")\n            .removeClass(\"d-none\")\n            .text(\"Sum: \" + diffSum + \" / \" + totalTarget);\n          valid = false;\n        } else {\n          root.find(\"#diff-validation-msg\").addClass(\"d-none\");\n        }\n      }\n\n      // Validate Bloom if visible\n      if (!root.find(\"#cognitive-dist\").hasClass(\"d-none\")) {\n        var bloomSum = this.getSum(\"bloom\");\n        if (bloomSum !== totalTarget) {\n          root\n            .find(\"#bloom-validation-msg\")\n            .removeClass(\"d-none\")\n            .text(\"Sum: \" + bloomSum + \" / \" + totalTarget);\n          valid = false;\n        } else {\n          root.find(\"#bloom-validation-msg\").addClass(\"d-none\");\n        }\n      }\n\n      root.find(\"#btn-generate-confirm\").prop(\"disabled\", !valid);\n      return valid;\n    },\n\n    updateSelectionFromRange: function (rangeStr) {\n      if (!rangeStr) {\n        return;\n      }\n\n      var root = this.modal.getRoot();\n      // Uncheck all first\n      root.find(\".slide-toggle\").prop(\"checked\", false);\n\n      var parts = rangeStr.split(\",\");\n      parts.forEach(function (part) {\n        var bounds = part.trim().split(\"-\");\n        if (bounds.length === 2) {\n          var start = parseInt(bounds[0]);\n          var end = parseInt(bounds[1]);\n          for (var i = start; i <= end; i++) {\n            root\n              .find('.slide-row[data-page=\"' + i + '\"] .slide-toggle')\n              .prop(\"checked\", true);\n          }\n        } else if (bounds.length === 1 && bounds[0] !== \"\") {\n          var p = parseInt(bounds[0]);\n          root\n            .find('.slide-row[data-page=\"' + p + '\"] .slide-toggle')\n            .prop(\"checked\", true);\n        }\n      });\n    },\n\n    triggerGeneration: function () {\n      var self = this;\n      var root = self.modal.getRoot();\n\n      // Collect Options\n      var numQuestions = parseInt(root.find(\"#id_numquestions\").val());\n      var difficulty = root.find(\"#id_difficulty\").val();\n      var bloomLevel = root.find(\"#id_cognitive\").val();\n\n      var difficultyDistribution = null;\n      var bloomDistribution = null;\n\n      if (difficulty === \"mixed\") {\n        difficultyDistribution = {};\n        root.find('.dist-input[data-type=\"difficulty\"]').each(function () {\n          difficultyDistribution[$(this).data(\"key\")] =\n            parseInt($(this).val()) || 0;\n        });\n      }\n\n      if (bloomLevel === \"mixed\") {\n        bloomDistribution = {};\n        root.find('.dist-input[data-type=\"bloom\"]').each(function () {\n          bloomDistribution[$(this).data(\"key\")] = parseInt($(this).val()) || 0;\n        });\n      }\n\n      var includeSlides = [];\n      root.find(\".slide-toggle:checked\").each(function () {\n        // Get page number from data-page of parent row\n        var row = $(this).closest(\".slide-row\");\n        includeSlides.push(row.data(\"page\"));\n      });\n\n      var includeImages = [];\n      root.find(\".image-toggle:checked\").each(function () {\n        // Prefer imageId (new format), fallback to source (legacy)\n        var imageId = $(this).data(\"imageid\");\n        if (imageId) {\n          includeImages.push(imageId);\n        } else {\n          // Fallback: use source from data attribute or parse from name\n          var source = $(this).data(\"source\");\n          if (source) {\n            includeImages.push(source);\n          } else {\n            var name = $(this).attr(\"name\");\n            if (name) {\n              var match = name.match(/include_image\\[(.*)\\]/);\n              if (match && match[1]) {\n                includeImages.push(match[1]);\n              }\n            }\n          }\n        }\n      });\n\n      var options = {\n        numQuestions: numQuestions,\n        difficulty: difficulty,\n        bloomLevel: bloomLevel,\n        includeSlides: includeSlides,\n        includeImages: includeImages,\n      };\n\n      if (difficultyDistribution) {\n        options.difficultyDistribution = difficultyDistribution;\n      }\n      if (bloomDistribution) {\n        options.bloomDistribution = bloomDistribution;\n      }\n\n      // UI Loading state\n      root\n        .find(\"#btn-generate-confirm\")\n        .prop(\"disabled\", true)\n        .html('<i class=\"fa fa-spinner fa-spin\"></i> Generating...');\n\n      $.ajax({\n        url: M.cfg.wwwroot + \"/mod/classengage/slides_api.php\",\n        type: \"POST\",\n        data: {\n          action: \"generate_from_options\",\n          slideid: self.slideid,\n          docid: self.docid,\n          options: JSON.stringify(options),\n          sesskey: M.cfg.sesskey,\n        },\n        dataType: \"json\",\n        success: function (response) {\n          if (response.success) {\n            // Show success summary before closing\n            var summaryHtml =\n              '<div class=\"alert alert-success\">' +\n              '<h5><i class=\"fa fa-check-circle\"></i> Generation Complete</h5>' +\n              '<div class=\"row mt-3\">' +\n              '<div class=\"col-6\">' +\n              \"<strong>Questions Generated:</strong> \" +\n              response.count;\n\n            if (response.expected && response.count !== response.expected) {\n              summaryHtml +=\n                ' <small class=\"text-warning\">(requested: ' +\n                response.expected +\n                \")</small>\";\n            }\n\n            summaryHtml += \"</div>\";\n\n            if (response.provider) {\n              summaryHtml +=\n                '<div class=\"col-6\">' +\n                '<strong>Provider:</strong> <span class=\"badge badge-dark\">' +\n                response.provider +\n                \"</span>\";\n              if (response.model) {\n                summaryHtml +=\n                  ' <small class=\"text-muted\">(' + response.model + \")</small>\";\n              }\n              summaryHtml += \"</div>\";\n            }\n\n            summaryHtml += \"</div>\";\n\n            // Show distribution plan if available\n            if (response.plan) {\n              summaryHtml +=\n                '<div class=\"mt-2\"><small class=\"text-muted\">' +\n                '<i class=\"fa fa-list\"></i> Distribution: ' +\n                Object.keys(response.plan).length +\n                \" categories\" +\n                \"</small></div>\";\n            }\n\n            summaryHtml +=\n              '<p class=\"mt-3 mb-0 text-muted\"><small>Redirecting in 3 seconds...</small></p>' +\n              \"</div>\";\n\n            root.find(\"#generator-content\").html(summaryHtml);\n            root.find(\"#btn-generate-confirm\").hide();\n\n            // Redirect after 3 seconds\n            setTimeout(function () {\n              self.modal.hide();\n              window.location.reload();\n            }, 3000);\n          } else {\n            alert(\"Error: \" + response.error);\n            root\n              .find(\"#btn-generate-confirm\")\n              .prop(\"disabled\", false)\n              .text(\"Generate\");\n          }\n        },\n        error: function () {\n          alert(\"Network error during generation.\");\n          root\n            .find(\"#btn-generate-confirm\")\n            .prop(\"disabled\", false)\n            .text(\"Generate\");\n        },\n      });\n    },\n  };\n\n  return GeneratorWizard;\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","Ajax","Notification","Str","GeneratorWizard","modal","cmid","slideid","docid","pages","init","document","on","e","preventDefault","btn","currentTarget","data","openWizard","bind","this","self","create","type","types","DEFAULT","large","then","get_string","title","setTitle","render","numquestions_options","html","js","setBody","runTemplateJS","setFooter","show","inspectDocument","root","getRoot","updateSelectionFromRange","val","checked","is","find","prop","triggerGeneration","link","alert","checkDistributionVisibility","validateDistribution","fail","exception","call","methodname","args","ajax","url","M","cfg","wwwroot","action","sesskey","dataType","success","response","renderPages","error","container","empty","forEach","page","shorttext","text","replace","substring","images","img","push","source","safe_source","mediaType","append","pagenum","fulltext","hasmore","length","promises","imageId","label","when","apply","done","addClass","removeClass","i","result","arguments","diff","bloom","num","parseInt","showPanel","getSum","distributeEvenly","sum","each","total","inputs","count","base","Math","floor","remainder","index","totalTarget","valid","hasClass","diffSum","bloomSum","rangeStr","split","part","bounds","trim","start","end","p","numQuestions","difficulty","bloomLevel","difficultyDistribution","bloomDistribution","includeSlides","row","closest","includeImages","name","attr","match","options","JSON","stringify","summaryHtml","expected","provider","model","plan","Object","keys","hide","setTimeout","window","location","reload"],"mappings":"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"}