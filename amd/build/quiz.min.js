/**
 * JavaScript for real-time quiz participation
 *
 * @module     mod_classengage/quiz
 * @package
 * @copyright  2025 Danielle
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_classengage/quiz",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){var currentQuestion=null,pollingTimer=null,countdownTimer=null;return{init:function(cmid,sessionid,pollinginterval){var self=this;this.startPolling(sessionid,pollinginterval),$(document).on("click",".submit-answer-btn",(function(){self.submitAnswer(sessionid)}))},startPolling:function(sessionid,interval){var self=this;pollingTimer=setInterval((function(){self.getCurrentQuestion(sessionid)}),interval),this.getCurrentQuestion(sessionid)},getCurrentQuestion:function(sessionid){var self=this;Ajax.call([{methodname:"mod_classengage_get_current_question",args:{sessionid:sessionid},done:function(response){self.updateQuestionDisplay(response)},fail:function(){$.ajax({url:M.cfg.wwwroot+"/mod/classengage/ajax.php",method:"POST",data:{action:"getcurrent",sessionid:sessionid,sesskey:M.cfg.sesskey},dataType:"json",success:function(response){self.updateQuestionDisplay(response)}})}}])},updateQuestionDisplay:function(response){var container=$("#question-container"),statusDiv=$("#quiz-status");if(!response.success||"active"!==response.status)return container.html(""),void("completed"===response.status?(statusDiv.removeClass("alert-info").addClass("alert-success"),statusDiv.html(M.util.get_string("quizcompleted","mod_classengage")),this.stopPolling()):statusDiv.html(M.util.get_string("waitingnextquestion","mod_classengage")));var question=response.question;question?(null!==currentQuestion&&currentQuestion.id===question.id||(currentQuestion=question,this.displayQuestion(question)),this.updateTimer(question.timeremaining),statusDiv.html(M.util.get_string("currentquestion","mod_classengage",{current:question.number,total:question.total}))):container.html("<p>"+M.util.get_string("waitingnextquestion","mod_classengage")+"</p>")},displayQuestion:function(question){var html='<div class="question-text mb-4">';if(html+="<h4>"+question.text+"</h4>",html+="</div>",question.answered)html+='<div class="alert alert-info">'+M.util.get_string("alreadyanswered","mod_classengage")+"</div>";else{html+='<form id="answer-form">',html+='<div class="question-options">';for(var i=0;i<question.options.length;i++){var option=question.options[i];html+='<div class="quiz-option">',html+="<label>",html+='<input type="radio" name="answer" value="'+option.key+'" required> ',html+="<strong>"+option.key+".</strong> "+option.text,html+="</label>",html+="</div>"}html+="</div>",html+='<button type="button" class="btn btn-primary btn-lg submit-answer-btn mt-3">',html+=M.util.get_string("submitanswer","mod_classengage"),html+="</button>",html+="</form>"}$("#question-container").html(html)},updateTimer:function(seconds){var display=$("#timer-display");if(seconds<=0)return display.text("0:00"),void display.removeClass("warning").addClass("danger");var secs=seconds%60,timeStr=Math.floor(seconds/60)+":"+(secs<10?"0":"")+secs;display.text(timeStr),seconds<=10?display.removeClass("warning").addClass("danger"):seconds<=30?display.removeClass("danger").addClass("warning"):display.removeClass("warning danger")},submitAnswer:function(sessionid){var selectedAnswer=$('input[name="answer"]:checked').val();selectedAnswer?currentQuestion&&$.ajax({url:M.cfg.wwwroot+"/mod/classengage/ajax.php",method:"POST",data:{action:"submitanswer",sessionid:sessionid,questionid:currentQuestion.id,answer:selectedAnswer,sesskey:M.cfg.sesskey},dataType:"json",success:function(response){if(response.success){var message=response.iscorrect?M.util.get_string("correct","mod_classengage"):M.util.get_string("incorrect","mod_classengage");$("#question-container").html('<div class="alert alert-'+(response.iscorrect?"success":"warning")+'"><h4>'+message+"</h4><p>"+M.util.get_string("correctanswer","mod_classengage")+": "+response.correctanswer+"</p><p>"+M.util.get_string("waitingnextquestion","mod_classengage")+"</p></div>")}else Notification.exception({message:response.error||"Error submitting answer"})},error:function(){Notification.exception({message:"Error submitting answer"})}}):Notification.alert(M.util.get_string("error"),M.util.get_string("selectanswer","mod_classengage"))},stopPolling:function(){pollingTimer&&(clearInterval(pollingTimer),pollingTimer=null),countdownTimer&&(clearInterval(countdownTimer),countdownTimer=null)}}}));

//# sourceMappingURL=quiz.min.js.map